introduction
    p.
        These are notes for Jennifer Balakrishnan's course MA841 at BU, Fall 2019.

    p.
        The course webpage is #[url(href="http://math.bu.edu/people/jbala/841.html")/].

section#sec-p-adic-rat-pts
    title Rational points on curves

    aside: p Lecture 1 5/9/2019
    p
        |Main Question: How do we determine #[m X(\QQ)] for #[m X] smooth projective of genus #[m \ge 2]?
        | What computational tools are involved?
    p
        | Topics:
        ol
            li: p
                | Chabauty-Coleman method
            li: p
                | Coleman integration (#[m p]-adic integration)
            li: p
                | #[m p]-adic heights
            li: p
                | quadratic Chabauty

    p
        | Evaluation (if you need a grade), TeX 3-4 classes worth of lecture notes.
    p
        | Detailed list of topics:
        ul
            li Chabauty-Coleman
            li Explicit Coleman integration
            li #[m p]-adic cohomology, based point counting (Kedlaya + Tuitman)
            li Iterated Coleman integration
            li Chabauty-Coleman in practice + other tools
            li Étale descent
            li Covering collections
            li Elliptic curve Chabauty
            li #[m p]-adic heights on elliptic curves
            li #[m p]-adic heights on Jacobians on curves
            li Local heights
            li Quadratic Chabauty for integral points on affine hyperelliptic curves
            li Kim's nonabelian Chabauty program
            li Nekovář's p-adic height
            li Quadratic Chabauty for #[m \QQ]-points on curves
            li Quadratic Chabauty in practice

    p
        |References for first two weeks:
        ul
            li
                | McCallum-Poonen
            li Stoll: #[url(href="http://www.mathe2.uni-bayreuth.de/stoll/teaching/ArithHypKurven-SS2014/Skript-ArithHypCurves-pub-screen.pdf") Arithmetic of Hyperelliptic Curves]
            li
                | Kedlaya: #[m p]-adic cohomology from theory to practice (notes from 2007 AWS)
            li Besser: #[url(href="https://www.math.bgu.ac.il/~bessera/Heidelberg-lecture") Heidelberg lectures on Coleman integration]
    p
        | For computations
        ul
            li Sage
            li MAGMA

section#sec-chab-coleman
    title The Chabauty-Coleman method


    subsection#subsec-triangles
        title A question about triangles

        p
            | Does there exist a rational right triangle and  a rational isosceles triangle with with same perimeter and same area?
            | (rational means all side lengths are rational)

        p
            | Suppose there does exist such a pair, then introducing parameters, #[m k,t] for the right triangle, and #[m l,u] for the isosceles we can rescale to
            me k,t,u \in \QQ
            me 0 \lt t, u \lt 1,\, k \gt 0
            | an equate areas and perimeters.
            | Areas:
            me \frac 12(2kt)(k)(1-t^2) = \frac 12(4u)(1-u^2)
            me \implies k^2 t^2(1-t^2) = 2u (1-u^2)
            | . Perimeters:
            me k(1-t^2) + k(1+t^2) + 2kt = 1 + u^2 + 1 + u^2 + 4u
            me \implies k+ kt = 1 + 2u + u^2 = (1+u)^2
            | so letting #[m x=1 +u], after some algebra we have #[m 1 \lt x \lt 2] in #[m \QQ] s.t.
            me 2xk^2 + (-3x^3 -2x^2 + 6x - 4)k + x^5 = 0
            | this is a quadratic in #[m k], and the discriminant is a square in #[m \QQ].
            |so
            me X\colon  y^2 = (-3x^3 - 2x^2 + 6x - 4)^2 - 4(2x)x^5
            me = x^{6} + 12 x^{5} - 32 x^{4} + 52 x^{2} - 48 x + 16
            | so this is a genus 2 hyperelliptic curve. We need the #[m \QQ]-points of this.
        paragraphs
            title Facts:
            p
                | #[m \Jac(X)]  has Mordell-Weil rank 1.
                | The Chabauty-Coleman bound on the size of #[m X(\QQ)] for this curve gives #[m \#X(\QQ) \le 10].
                | But we find points
                md
                    mrow \left\{ \left(0 : -4 : 1\right), \infty_{\pm} , \left(0 : 4 : 1\right), \left(1 : -1 : 1\right), \left(1 : 1 : 1\right),\left(\frac{12}{11} : -\frac{868}{1331} : 1\right),\right.
                    mrow \left. \left(\frac{12}{11} : \frac{868}{1331} : 1\right), \left(2 : -8 : 1\right), \left(2 : 8 : 1\right)\right\}
                | so this set is #[m X(\QQ)].
        p
            | Back in the original problem we specified #[m x \lt 1 \lt 2], so there is a unique such pair of triangles:
        theorem
            title Hirakawa-Matsumura '18
            statement: p
                | Up to similitude there exists a unique pair of a rational right triangle and a rational isosceles triangle that have the same perimeters and areas.
                | The unique pair consists of a right triangle with sides
                me (377, 135, 352)
                | and the isosceles triangle with sides
                me (366, 366, 132)
                | .
    subsection
        title Why care about #[m X(\QQ)] for #[m X] of genus 2?

        p
            | Curves of genus 0: have no #[m \QQ]-points or infinitely many, they satisfy a local to global principle so there exists an algorithm to determine the #[m \QQ]-points in finite time.

        p
            | Curves of genus 1: If we have 1 smooth rational point then we have an elliptic curve, Mordell's theorem implies that #[m E(\QQ)] is a finitely generated abelian group,
            me E(\QQ) \simeq \ZZ^r \oplus T
            | where the possible torsion parts #[m T] have been determined by Mazur's theorem.
            | To understand #[m T], and the distribution of #[m T] there is work of Harron and Snowden, this often comes down to understanding rational points on #[m X_1(N)].
        p
            | Upshot: to understand #[m E(\QQ)] we want to understand #[m r]:
        p
            | Q1: is there an algorithm to compute #[m  r]?
        p
            | Q2: what values of                   #[m  r] can occur?
        p
            | Q3: what is the distribution of      #[m  r]?
        p
            | A1: #[m n]-descent, the obstacle is #[m \Sha], proving finiteness, it is conjectured that #[m r =  \ord_{s=1}L(E,s)] (BSD).
        p
            | A2: record due to Noam Elkies an example of #[m E] with #[m r \ge 28].
        p
            | A3: minimalist conjecture: 50% of all curves have rank 0, 50% rank 1.

        theorem#thm-bhargava-shankar
            title Bhargava-Shankar
            statement
                p
                    |The average rank is #[m \lt 1].

        p
            | Baur Bektemirov, Barry Mazur, William Stein, and Mark Watkins, Average ranks of elliptic curves: tension between data and conjecture, Bull. Amer. Math. Soc. (N.S.) 44 (2007), no. 2, 233–254. MR 2009e:11107 gave average rank graphs, which kept increasing.
        p
            | Sarnak said there would #[q obviously be a turn around].
        p
            | Jennifer S. Balakrishnan, Wei Ho, Nathan Kaplan, Simon Spicer, William Stein, and James Weigandt, Databases of elliptic curves ordered by height and distributions of Selmer groups and ranks, LMS J. Comput. Math. 19 (2016), supp. A, pp. 351-370. MR 3540965



    subsection
        title Coleman's bound
        aside: p Lecture 2 10/9/2019
        p
            | Goal today: prove Coleman's refinement of Chabauty's theorem.

        theorem
            title Coleman 1985
            statement: p
                | Let #[m X/\QQ] be a curve of genus #[m g \ge 2].
                | Suppose the Mordell-Weil rank of #[m J(\QQ)] is less than #[m g].
                | Then if #[m p \gt 2g] is a good prime for #[m X] we have
                me \#X(\QQ) \le \#X_{\FF_p} (\FF_p) + 2g - 2
                |.

        definition#def-differentials
            title Differentials
            statement
                p
                    | Let #[m X] be a  curve over a field #[m k].
                    | The space of #[term differentials] on #[m X] over #[m k] is a 1-dimensional #[m k(X)]-vector space #[m \Omega ^1_X(k)].
                p
                    | There is a nontrivial #[m k]-linear derivation
                    me \diff \colon  k(X) \to \Omega ^1_X(k)
                    | i.e. #[m \diff] is #[m k]-linear and satisfies the Leibniz rule
                    me \diff(fg) = g \diff f + f \cdot \diff g
                    | for all #[m f,g\in k(X)] and there is some #[m f \in k(X)] s.t. #[m \diff f \ne 0].
                p
                    | A general differential can be written as #[m \omega  = f \diff g] where #[m g\in K(X)] with #[m \diff g \ne 0].
                    | If we fix #[m g] this representation is unique.
                    | If #[m \omega ,\omega ' \in \Omega ^1_X(k)] with #[m \omega ' \ne0] then there's a unique #[m f\in K(X)] s.t. #[m \omega = f\omega '].
                    | We may write #[m \omega /\omega ' = f].

        definition#def-differentials-first-second
            title Differentials of the first second and third kinds
            statement
                p
                    | Let #[m 0\ne \omega  \in \Omega ^1_X(k)] and #[m P\in X(k)].
                    | Let #[m t\in k(X)] be  a uniformizer at #[m P].
                    | Then #[m v_P(\omega ) = v_P(\omega /\diff t)] is the valuation of #[m  \omega ] at #[m P].
                    | This valuation is nonzero for only finitely many points #[m P \in X(\overline k)].
                    | The divisor
                    me \divisor(\omega ) = \sum_{P\in X(\overline k)}v_P(\omega ) P \in \Div_X(k)
                    | is the divisor of #[m \omega].
                p
                    | If #[m v_P(\omega )\ge] then #[m \omega ] is regular at #[m P] and #[m \omega ] is said to be regular if it is regular at all points #[m P\in X(\overline K)].
                p
                    | Also called differentials of the #[term first kind].
                p
                    | A differential of the #[term second kind] has residue zero at all points #[m P\in X(\overline K)].
                p
                    | A differential of the #[term third kind] has at most a simple pole at all points #[m P\in X(\overline K)] (and integer residues there in some references).

        p
            | Since the quotient of any two non-zero differentials is  a function
            me \omega_1 = f_1 \diff g
            me \omega_2 = f_2 \diff g
            | so
            me \frac{\omega _1}{\omega _2}  = \frac{f_1}{f_2}
            | .
            | The difference  of any two divisors of differentials is a principal divisor.
            me \divisor\left(\frac{\omega _1}{\omega _2}\right)  = \divisor \left(\frac{f_1}{f_2}\right)
            me = \divisor \omega _1 - \divisor \omega _2
            |.
        p
            | So the divisors of differentials form one linear equivalence class of divisors, the canonical class.

        paragraphs
            title Recall
            p
                | Let #[m X/k] be a curve and #[m D\in \Div_X(k)]. The Riemann-Roch space of #[m D] is the #[m k]-vector space
                me L(D) = \left\{\phi \in k(X)^\times : \divisor \phi  + D \ge 0\right\} \cup \{0\}
                | where we write #[m D \ge D'] if #[m v_P(D) \ge v_P(D')] for all #[m P].

        theorem
            title Riemann-Roch
            statement
                p
                    | Let #[m X/k] be a curve of genus #[m g] then there is a divisor #[m W \in \Div_X(k)] s.t. for every #[m D\in \Div_X(k)] w we have #[m \dim_k L(D)] is finite and
                    me \dim_k L(D)  = \deg D - g +1 \dim_l L(W -D)
                    | .
                p
                    | In particular, #[m \dim_k L(W) = g], #[m \deg W = 2g-2].
                p
                    | The canonical class is exactly the class of the divisor #[m W] in Riemann-Roch.
                p
                    | The #[m k]-vector space of regular differentials has #[m \dim L(W)  = g], and is denoted as #[m H^0(X, \Omega ^1_X)].
        example
            statement: p
                | Let #[m X\colon  y^2 = f(x)] be a hyperelliptic curve of genus #[m g] over #[m k].
                | Then #[m H^0(X, \Omega ^1_X)] has basis
                me \left\{ \frac{\diff x}{2y}, \ldots, \frac{x^{g-1}\diff x}{2y} \right\}
                | so every regular differential can be written uniquely as
                me \frac{p(x) \diff x}{2y}
                | with a polynomial #[m p] of degree #[m \le g-1].
        p
            | We want to integrate differentials in some #[m p]-adic sense,
            | Q: What does a #[m p]-adic line integral look like?

        theorem
            statement: p
                | Let #[m X/\QQ_p] be a curve with good reduction then there is a #[m p]-adic integral
                me \int_P^Q \omega  \in \overline \QQ_p
                | defined for each pair of points #[m P,Q\in X(\overline \QQ_p)] and regular differential #[m \omega \in H^0(X, \Omega _X^1(\overline \QQ_p))] that satisfies the following properties:
                ol
                    li
                        | The integral is #[m \overline \QQ_p] linear in #[m \omega ]
                    li
                        | If #[m P,Q] both reduce to the same point #[m \bar P \in X_{\FF_p}(\FF_p)] then the integral can be evaluated by writing
                        me \omega  = \omega (t) \diff t
                        | with #[m t] a uniformizer at #[m P] reducing to  a uniformizer at #[m \bar P] and #[m \omega ] a power series.
                        | Then integrating formally  obtaining a power series #[m l] s.t.
                        me \diff l(t) = w(t) \diff t
                        |and #[m l(0) = 0] and finally evaluating
                        me l(t(Q))
                        | which converges.
                        | This implies that #[m \int_P^P \omega  = 0].
                    li
                        me \int_P^Q \omega  + \int_{P'}^{Q'} \omega  =  \int_P^{Q'} \omega   + \int_{P'}^Q \omega 
                        | so it makes sense to define:
                        me \int_D \omega
                        | for
                        me \sum_{j=1}^n Q_j  - P_j \in \Div^0_X(\overline \QQ_p)
                        | as
                        me \int_D \omega  = \sum_{j=1}^n \int_{P_j}^{Q_j} \omega 
                    li
                        | If #[m D] is principal then #[m \int_D \omega  = 0].
                    li
                        | The integral commutes with the action of #[m \absgal{\QQ_p}].
                    li
                        | Fix #[m P_0 \in X(\overline \QQ_p)].
                        | If #[m 0\ne \omega  \in H^0(X, \Omega ^1_X)],
                        | then the set of points #[m P \in X(\overline \QQ_p)] reducing to a fixed point #[m P_0 \in X_{\FF_p}(\overline \FF_p)].
                        | and s.t.
                        me \int_{P_0}^P \omega  = 0
                        | is finite.

        remark
            p
                | The statement that the curve has good reduction is not necessary but simplifies the statement of 2.

        remark
            p
                | This    integral is the Coleman integral #[xref(ref="bib-coleman-torsion")/], other works on #[m p]-adic integration include Berkovich #[xref(ref="bib-berkovich")/].
                | Also there is work of Zarhin, Colmez, Vologodsky, Besser, ...

        remark
            p
                | Theory of Coleman integration of forms the second or third kind developed by Coleman-de Shalit #[xref(ref="bib-coleman-de-shalit")/].
                | (additivity in endpoints, linearity, change of variables, FTC).

        corollary
            statement: p
                | Given the hypotheses of the previous theorem
                me P_0 \in X(\QQ_p)
                | and #[m J] the Jacobian of #[m X] let
                me \iota  \colon X \to J
                | be the embedding
                me P \mapsto [P - P_0]
                | there is a map
                me J(\QQ_p) \times H^0(X, \Omega _X^1) \to \QQ_p
                me (P,\omega ) \mapsto \pair P \omega 
                | that is additive in #[m P] and #[m \QQ_p] linear in #[m \omega ] which is given by
                me \pair{[D]}\omega  = \int_D \omega 
                | in particular for
                me P\in X(\QQ_p)
                | we have
                me \pair{\iota (P)}\omega  = \int_{P_0}^P \omega 
                | .
        remark
            p
                | If #[m P \in J(\QQ_p)] has finite order, then
                me \pair P\omega =0,\,\forall \omega \in H^0(X, \Omega _X^1)
                | to see this, if #[m nP= 0] then
                me \pair P\omega  = \frac1n\pair{nP}\omega  = \frac1n0 = 0
                |.
                | One can show that torsion points are the only points with this property.
                | On the other hand, if #[m \omega ] has the property that  #[m \pair P\omega  = 0] for all #[m P \in J(\QQ_p)] then #[m \omega =0].


        corollary
            statement: p
                | Let #[m X/\QQ] be a curve of genus #[m g] with Mordell-Weil rank less than #[m g]. Then #[m \# X(\QQ)] is finite.
                | Note we don't need #[m g \ge 2], in #[m g=1] this applies to rank 0.
            proof
                p
                    | Pick a prime of good reduction for #[m X] let
                    me  V = \{ \omega  \in H^0(X, \Omega _X^1) : \forall P \in J(\QQ) : \pair P\omega  = 0\}
                    | by additivity in the first argument this condition is equivalent to requiring that #[m \pair{P_j}\omega  = 0] for a basis #[m \{P_j\}_{j=1}^r] of the free part of #[m J(\QQ)] so it leads to at most #[m r] linear constraints, so #[m \dim V \ge g - r \gt 0].
                    |So there is some #[m 0 \ne \omega  \in V] pick #[m P_0 \in X(\QQ)], if #[m X(\QQ) = \emptyset] we are done.
                    | To define #[m \iota \colon X \hookrightarrow J].
                    | Since #[m \iota (P) \in J(\QQ)] for all #[m P\in X(\QQ)] so it follows that #[m \int_{P_0}^P\omega =0] for all #[m P\in X(\QQ)].
                    | By the theorem the number of such #[m P] is finite in each residue disk of #[m X(\QQ)].
                    | Since the number of residue classes is  #[m \# X(\FF_p)] which is finite.
                    | The total number of points in #[m X(\QQ)] is finite also.
                p
                    | To get an actual bound we have to bound the number of zeroes of
                    me \int_{P_0}^z \omega 
                    | as a #[m p]-adic power series.
                    | We can think of #[m X(\QQ_p)] set theoretically as a finite union of residue disks.
                    | Within each residue disk
                    me \int_{P_0}^z \omega 
                    | has finitely many #[m p]-adic zeroes.


        aside: p Lecture 3 10/9/2019
        p
            | We want  to give  a more refined version of this result which uses results about zeroes of #[m p]-adic power series.
        theorem
            statement: p
                | Let
                me 0 \ne l(t) = \sum_{n=0}^\infty a_nt^n\in \QQ_p[[t]]
                | such that #[m a_n \to 0] as #[m n \to \infty ] in the #[m p]-adic topology.
                | Let
                me v_0 = \min\{ v_p(a_n) : n \ge 0 \}
                | and
                me N = \max\{ n \ge 0, v_p (a_n) = v_0\}
                | then there is a constant
                me c \in \QQ_p^\times
                | a monic polynomial
                me q \in \ZZ_p[t]
                | of degree #[m N], a power series
                me h(t) = \sum_{n = 0}^\infty  b_n t^n \in 1+  pt \ZZ_p[[t]]
                | with
                me b_n \to 0 \text{ as } n \to \infty 
                | and
                me l(t) = cq(t)h(t)
                | .
            proof
                p
                    | After rescaling by #[m a_0\inv] can assume #[m v_0 = 0]
                    |and #[m a_N = 1]
                    | so this in particular #[m l(t) \in \ZZ_p\lb \lb t\rb \rb ]
                    | the condition #[m a_n \to 0]
                    | means that the image #[m l_m(t)] of #[m l(t)] in #[m \ZZ/p^m\ZZ[[t]]] is actually a polynomial for all #[m m \ge1].
                p
                    | The idea is to construct inductively constants #[m c_m \in (\ZZ/p^m)^\times], monic polynomials #[m q_m(t) \in (\ZZ/p^m)\lb t\rb ] of degree #[m N] and polynomials #[m h_m(t) \in (\ZZ/p^m)\lb t\rb ] with #[m h_m \equiv 1 \pmod{pt}] satisfying
                    me l_m(t) = c_m q_m(t) h_m(t)
                    |and such that
                    me (c_{m+1}, q_{m+1}, h_{m+1})
                    | reduces #[m \pmod{p^m}] to
                    me (c_{m}, q_{m}, h_{m})
                    | .
                p
                    | Then there is a unique #[m c, q, h] as above such that
                    me (c, q, h)
                    | reduces #[m \pmod{p^m}] to
                    me (c_{m}, q_{m}, h_{m})
                    | for all #[m m].
                p
                    | To start the  induction set #[m c_1 = 1]
                    me q_1 (t) = l_1(t)
                    me h_1(t) = 1
                    | this is possible since #[m l_1(t)] is monic of degree #[m N].
                p
                    | Assume we've constructed #[m c_m,q_m,h_m], let
                    me \tilde c_{m+1}, \tilde q_{m+1}, \tilde h_{m+1}
                    | be arbitrary lifts of #[m c_m,q_m,h_m] to objects  over #[m \ZZ/p^{m+1}] with
                    me \tilde q_{m+1} \text{ monic of degree } N
                    me \tilde h_{m+1}(t) \equiv 1 \pmod{pt}
                    | then
                    me l_{m+1}(t) - \tilde c_{m+1} \tilde q_{m+1} \tilde h_{m+1} = p^m d(t)
                    | with
                    me d(t) \in (\ZZ/p)[t]
                    | then we must have
                    me c_{m+1} = \tilde c_{m+1} + p^m \gamma 
                    me q_{m+1} = \tilde q_{m+1} + p^m k(t)
                    me h_{m+1} = \tilde h_{m+1} + p^m \eta(t)
                    | with #[m \gamma \in \ZZ/p], #[m k\in (\ZZ/p)\lb t\rb ] of degree #[m \lt N]. and #[m \eta \in (\ZZ/p)\lb  t\rb ] with #[m \eta(0) = 0].
                p
                    | For #[m \gamma \in \ZZ /p \ZZ], #[m k(t) \in  (\ZZ /p \ZZ) \lb  t\rb ] of degree less than #[m N], and #[m \eta(t) \in  (\ZZ /p \ZZ) \lb t\rb ] with #[m \eta (0) = 0].
                    | So the relation #[m l_{ m+1} (t) = c_{ m+1} q_{ m+1} (t)h_{m+1 }(t)] is equivalent to #[m d(t) = (\gamma  +  \eta(t)) l_1 (t) + k(t)], and
                    | #[m \gamma , k(t)], and #[m \eta(t)] are uniquely determined through division by #[m l_1 (t)] with remainder #[m d(t)], and this determines #[m c_{m+1} ,\, q_{ m+1} (t)] , and #[m h_{m+1} (t)].

        p
            | Now we apply this to study zeroes of #[m p]-adic power series coming from Coleman integrals.
        lemma
            statement: p
                | Let #[m l(t) \in \QQ_p\lb \lb t\rb \rb ] with formal derivative #[m w(t) \in \ZZ_p\lb \lb t\rb \rb ].
                | Such that the image #[m \bar w (t) \in \FF_p \lb \lb t\rb \rb ] has the form #[m ut^\nu + \cdots] with #[m u \in\FF_p\units].
                | Then #[m l] converges on #[m p \ZZ_p].
                | If #[m p \gt \nu + 2] then
                me \#\{\tau  \in p\ZZ_p : l(t) = 0 \} \le \nu + 1
                | .
            proof
                p
                    | Let
                    me w(t) = w_0 + w_1t + \cdots
                    me l(t) = l_0 + l_1t + \cdots
                    | then
                    me l_{n+1}  = \frac{w_n}{n+1} \in \frac{1}{n+1}\ZZ_p
                    | since #[m v_p(n+1) = O(\log n)] the assumption that
                    me w_n \in \ZZ_p
                    | implies that #[m v_p(l_n) = v_p(w_n/(n+1))\ge - c\log n] for some constant #[m c].
                    | If #[m \tau  \in p \ZZ_p] so #[m v_p(\tau ) \ge 1], then
                    me v_p(l_n\tau ^n) \ge n - c\log n  \to \infty 
                    | as #[m n \to \infty ], hence #[m l(\tau )] converges.
                    | Now consider #[m l(pt) = l_0 + pl_1t + p^2 l_2 t^2 + \cdots].
                    | The claim is that in the notation of the previous theorem we have #[m N \le \nu +1].
                    me v_p(p^{\nu  + 1} l_{\nu +1}) = \nu  + 1 + v_p(l_{\nu +1})
                    me = \nu +1 + v_p\left(\frac{w_\nu }{\nu +1}\right)
                    me = \nu  + 1+  v_p(w_\nu ) - v_p(\nu  + 1) \le \nu  + 1
                    |as by assumption #[m \bar w(t) \in \FF_p\lb \lb t\rb \rb ] has the form #[m ut^\nu +\cdots] so that #[m v_p(w_\nu ) =0].
                p
                    | For #[m n \gt \nu ] we have
                    me v_p(p^{n+1} l_{n+1}) = n+1 + v_p(l_{n+1})
                    me = n + 1+ v_p(w_n) - v_p(n+1)
                    me \ge n+1 - v_p(n+1)
                    | since
                    me v_p(w_n) \ge 0
                    | for #[m n \gt \nu ].
                    | So it suffices to show that
                    me n -  v_p(n+1) \gt \nu 
                    | This is clear for #[m v_p(n+1) = 0].
                    | Otherwise suppose #[m e = v_p(n+1)] then #[m p^e|(n+1)].
                    | So #[m n+1 \ge p^3 \gt \nu + e+ 1], where the second inequality can be shown by induction.
                    | For #[m e = 1] this is our hypothesis that #[m p \gt \nu  + 2], then use #[m p^{e+1}\ge p^e + 1].
                    | The previous corollary now gives the result.

        theorem
            title Coleman '85
            statement: p
                | Let #[m X/\QQ] be a curve of genus #[m g], with Mordell-Weil rank of #[m J] less than #[m g]. Then
                me \#X(\QQ) \le \#X(\FF_p) + 2g - 2
                | .
                | #[xref(ref="bib-coleman-chabauty")/].
            proof
                p
                    | We assume #[m P_0\in X(\QQ)], now arguing as in the proof of today's first corollary there is a non-zero differential #[m \omega  \in H^0(X, \Omega ^1_{X/\QQ_p})] such that
                    me \int_{P_0}^P \omega  = 0
                    | for all #[m P\in X(\QQ)].
                    | Now consider a point #[m \bar Q \in \overline X(\FF_p)] and lift it to #[m Q] in #[m X(\QQ_p)], we can pick a  uniformizer #[m t\in \QQ_p(X)\units] s.t at #[m Q] #[m t] reduces to a uniformizer #[m \bar t \in \FF_p(\overline X)\units ] at #[m \bar Q].
                    | We rescale #[m \omega ] s.t. its reduction #[m \bar \omega ] is defined an non-zero.
                    | Then #[m \bar \omega  \in H^0(X, \Omega ^1_{X/\FF_p})].
                    | Recall that #[m \divisor(\bar \omega)] is effective and has degree #[m 2g-2].
                    | Let #[m \nu (\bar Q)] denote the valuation at #[m \bar Q] of #[m \bar \omega ].
                    | #[m \nu (\bar Q) = \nu _{\bar Q}(\bar \omega )].
                    | We write #[m \omega (t) = w(t) \diff t] with 
                    me w(t) \in \ZZ_p[[t]]
                    | the coefficients are in #[m \ZZ_p] since #[m \bar \omega ] is defined.
                    | Then
                    me \bar \omega  = \bar w(t) \diff \bar t
                    | #[m \bar w(\bar t) = \bar t^{\nu (\bar Q)}(u_0 + u_1 \bar t + \cdots)].
                p
                    me \int_{P_0}^P \omega  =l(t(P))
                    | for #[m P \in X(\QQ_p)] such that #[m \bar p = \bar q] and apply previous lemma.
                    | Now summing over residue disks we get
                    me \#X(\QQ) \le \#\left\{ P\in X(\QQ_p) : \int_{P_0}^P \omega =0\right\}
                    me \le \sum_{\bar Q \in \bar X(\FF_p)} \left(\nu (\bar Q)  + 1\right)
                    me =\sum_{\bar Q \in \bar X(\FF_p)} \nu (\bar Q)  + \sum_{\bar Q \in \bar X(\FF_p)}1
                    me \le \deg(\divisor \omega ) + \# \bar X(\FF_p)
                    me = 2g - 2 + \# \bar X(\FF_p)
                    |.

        remark
            p
                | Stoll (06) showed that we can choose the best #[m \omega ] in each residue disk, can improve the bound, #[m r \lt g] and #[m p \gt 2r + 2] is a good prime then
                me \#X(\QQ) \le \#\overline X(\FF_p) + 2r
                | can also weaken the assumption that
                me p \gt  2r + 2
                | . If #[m p \gt 2] then
                me \# X(\QQ) \le \# \overline X(\FF_p) + 2r + \floor*{\frac{2r}{p-1}}
                | .
                | #[xref(ref="bib-stoll-independence")/].
                | Katz-Rabinoff-Zuerieck-Brown (12) extend Stoll's result tot the case of bad reduction, if #[m p \gt 2g] and #[m \mathcal X] a proper regular model for #[m X] over #[m \ZZ_p] then
                me \#X(\QQ) \le \#\mathcal X_{sm}(\FF_p) + 2r
                | where #[m \overline {\mathcal X}(\FF_p)] is the set of smooth points in the special fiber of minimal proper regular model of #[m X] over #[m \ZZ_p].
                | #[xref(ref="bib-katz-zureick-clifford")/].
        aside: p Lecture 4 17/9/2019

        p
            | A few results applying Chabauty-Coleman to prove uniform bounds:
        theorem
            title Stoll '13
            statement: p
                | If #[m X/\QQ] is hyperelliptic of genus #[m g] with Jacobian of Mordell-Weil rank #[m r \le g -3], then
                me \#X(\QQ) \le 8rg + 33(g-1) + 1
                | #[xref(ref="bib-stoll-uniform")/].

        theorem
            title Katz-Rabinoff-Zuerieck-Brown '19
            statement: p
                | If #[m X/\QQ] curves of genus #[m g] with #[m r\le g-3].
                me \#X(\QQ) \le 84 g^2 - 98 g + 28
                | .
                | Ref KRZB and expository paper.

        p
            | Suppose #[m X/\QQ] is genus 3, hyperelliptic curve of rank 0, Stoll's bound gives #[m \#X(\QQ) \le 67].
            | Is there a curve meeting this bound?
            | Or even #[m \#X(\QQ) =10]?
        p
            | In the LMFDB we find in #[m g=2], #[m r=0] the record seems to be #[m \#X(\QQ) = 8].
            | For #[url(href="http://lmfdb.org/Genus2Curve/Q/1116.a.214272.1")/] we have #[m \#X(\QQ) = 8].
            me J(\QQ) \simeq \ZZ/39
            | with simple Jacobian (first found by Elkies).

        p
            | It is possible to use constructions of Howe, Leprevost, Poonen, Elkies, others to construct Jacobians with even larger torsion (and possibly curves of low rank with many rational points?
            | Earlier we talked about computing annihilating differentials in the Chabauty-Coleman method. Here is a concrete example, to motivate a discussion of explicit Coleman integration.
        example
            statement: p
                | Consider
                me X\colon y^2 = x^5 - 4x^3 + 3x + 1
                | #[url(href="http://lmfdb.org/Genus2Curve/Q/3920.b.62720.1")/].
                me J(\QQ) \simeq \ZZ\oplus \ZZ/2
                | .
                me N = 3920 = 2^4 \cdot 5 \cdot 7^2
                | . And
                me X(\QQ) \supseteq\{\infty , (0,\pm1), (1,\pm1), (-1,\pm 1)\}
                me \#X_{\FF_{11}}(\FF_{11}) = 13
                me \#X_{\FF_{13}}(\FF_{13}) = 14
                | so the Chabauty-Coleman bound by itself does not prove that we found all the #[m \QQ]-points already.
                | The point
                me \lb (1,1) - \infty \rb 
                | is of infinite order in #[m J(\QQ)].
                | We use it to construct an annihilating differential.
                | Let #[m p = 11]. Then a basis of #[m H^0(X,\Omega ^1)] is given by
                me \left\{ \omega _i = \frac{x^i \diff x}{2y}\right\}_{i=0,1}
                | so the annihilating differential #[m \eta] is some  #[m \QQ_p]-linear combination of #[m \omega _0,\omega _1].
                | We use the values of
                me \int_\infty ^{(1,1)} \omega _0,\, \int_\infty ^{(1,1)} \omega _1
                | to compute #[m \eta].
                | We find
                me \int_\infty ^{(1,1)} \omega _0 = 8\cdot 11 + 7 \cdot 11^2 + 7\cdot 11^3 + 4\cdot 11^7 + 9\cdot 11^8 + O(11^9)   = \alpha 
                me \int_\infty ^{(1,1)} \omega _1 = 3\cdot 11 + 2\cdot 11^2 + 4\cdot 11^3 +  3  \cdot 11^4 + 6\cdot 11^5 + 6\cdot 11^6 + 8\cdot 11^7 + 3\cdot 11^8 + O(11^9)   = \beta 
                | .
                | Then
                me \int_{\infty }^{(1,1)} \beta  \omega _0 - \alpha \omega _1 =  0
                | so take
                me \eta                  =\beta  \omega _0 - \alpha \omega _1
                | .
                | To use #[m \eta] to compute #[m X(\QQ)] or more precisely, a finite subset of #[m X(\QQ_p)] containing #[m X(\QQ)] we need to compute the collection of indefinite Coleman integrals
                me \left\{\int_\infty ^{P_t} \eta\right\}
                | where #[m P_t] ranges over all residue disks.
                | And solve for #[m z\in X(\QQ_p)] such that
                me \int_\infty ^z \eta = 0
                | .
                | So to compute #[m \alpha ,\beta ] and the functions we needed Coleman integrals between points not in the same residue disk.

        p
            | Goal: show how to compute these #[m p]-adic integrals.

        p
            | Let #[m X/\QQ] be a curve.
            | Let #[m X^{an}] be the associated rigid analytic space.
            | (Let #[m \mathcal X] be a smooth curve over #[m \ZZ_p] s.t.
            me \mathcal X \otimes \QQ_p \simeq X\otimes \QQ_p
            | , then #[m X^{an}] denotes the rigid analytic space over #[m \QQ_p] which is the generic fibre of #[m \mathcal X].)

        definition
            statement: p
                | A wide open subspace of #[m X^{an}] is the complement in #[m X^{an}] of the union of a finite collection of disjoint closed disks of radius #[m \lambda _i \lt 1].
        example
            statement: p
                | Let
                me X\colon  y^2 = \prod_{i=1}^5 (x-\alpha _i)
                | take out closed disks of radius #[m \lambda _i] for each #[m P_i = (\alpha _i ,0)] and #[m \infty ].

        theorem
            title Coleman, Coleman-de Shalit
            statement
                p
                    | Let #[m \eta, \xi] be 1-forms on a wide open #[m V] of #[m X^{an}] and #[m P,Q,R \in V(\QQ_p)].
                    | Let #[m a,b\in \QQ_p].
                    | The definite Coleman integral has the following properties
                    ol
                        li
                            | Linearity
                            me \int_{P}^Q \alpha  \eta + b \xi = \alpha \int_P^Q \eta + b \int_P^Q \xi
                        li
                            | Additivity in endpoints
                            me \int_P^Q \eta = \int_P^R \eta + \int_R^Q \eta
                        li
                            | Change of variables, if #[m V' \subseteq X'] is a wide open subspace of a rigid analytic space #[m X'] and #[m \phi  \colon V \to V'] is a rigid analytic map then
                            me \int_P^Q \phi ^* \eta = \int_{\phi P}^{\phi Q} \eta
                            | .
                        li
                            | Fundamental theorem of calculus
                            me \int_P^Q \diff f = f(Q) - f(P)
                            | for #[m f] a rigid analytic function on #[m V].


        p
            | Goal: want to integrate
            me \int_P^Q \omega 
            | for a 1-form of the second kind, #[m P,Q \in V(\QQ_p)].
            |Idea
            ol
                li
                    | Take #[m \phi ] to be a lift of frobenius from the special fibre.
                li
                    | Write a basis #[m \{\omega _i\}] of 1-forms of the second kind.
                li
                    | Compute #[m \phi ^*\omega _i] and use properties of Coleman integral to relate #[m \int_P^Q \phi ^*\omega _i] to #[m \int_P^Q \omega _i] and other terms we can compute.

        p
            | #[xref(ref="bib-kedlaya-counting")/], #[xref(ref="bib-edixhoven-after")/], also Stephanie Chan MMath thesis (is this online?)

        p
            | Setup #[m p\ne 2] prime
            me \overline X/\FF_q,\,q=p^n
            | hyperelliptic of genus #[m g] with affine equation
            me y^2 = P(x)
            | with #[m P(x)] monic degree #[m 2g+1], with no repeated roots.
            me X \colon \overline X \smallsetminus \{ \infty , y=0\}
            | .
            | #[m W] ring of Witt vectors over #[m \FF_q], (the unique unramified extension of #[m \ZZ_p] with residue field #[m \FF_q].
        p
            | Choose a lift #[m \tilde P] of #[m P], to a monic polynomial of degree #[m 2g+1].
            | Over #[m W] this gives a  lift #[m \widetilde X] of #[m X].
            | Let #[m A = W\lb  x,y,y\inv\rb /(y^2 - \tilde P(x))]
            | Let #[m A^\dagger] be the weak completion of #[m A], explicitly let #[m v_p] denote the #[m p]-adic valuation on #[m W] extend it to polynomials.
            | If #[m g(x) = \sum a_i x^i], define #[m v_p(g) = \min\{v_p(a_i)\}].
            | The elements of #[m A^\dagger] are series
            me \sum_{-\infty }^\infty  ( S_n(x) + T_n(x)y)y^{2n}
            | where #[m S_n] and #[m T_n] are polynomials of degree at most #[m 2g] s.t. limits are positive.


        aside: p Lecture 5 19/9/2019

        p
            | References for Rigid Geometry:
            | #[xref(ref="bib-fresnel-van-der-put")/] #[xref(ref="bib-bgr")/].

        p
            | #[m \overline X/\FF_q] a hyperelliptic curve of genus #[m g], with odd degree model and monic, no repeated roots.
            me X\colon  \overline X \smallsetminus \{\infty , y= 0\}
            me \widetilde X
            | is a lift of #[m X] to #[m \ZZ_q] the ring of Witt vectors over #[m \FF_q].
        p
            me y^2  =  \tilde P(x)
            | .
        p
            me A \colon  \ZZ_q [x,y,y\inv]/(\tilde y^2 -\tilde P(x))
            | #[m A^\dagger] the weak completion of #[m A], this is
            me \left\{\sum_{-\infty }^\infty  s_n(x) y^n : s_n \in \ZZ_q[x],\,\deg s_n\le 2g,\, \ord_p(s_n) \gt c^n\text{ for some }c> 0\right\}
            |.

        p
            | Monsky-Washnitzer cohomology is a #[m p]-adic cohomology theory for smooth affine varieties, over fields of characteristic #[m p].

        theorem
            title Special case, Berthelot, (1974, 1997)
            statement: p
                | The algebraic de Rham cohomology of #[m \widetilde X] coincides with the Monsky-Washnitzer cohomology of #[m X].

        p
            | Monsky-Washnitzer cohomology is finite dimensional and is equipped with an action of Frobenius. So the theorem tells us that we can compute via a description of de Rham cohomology.
        proposition
            statement: p
                | The de Rham cohomology of #[m A] splits into eigenspaces under the hyperelliptic involution: a positive eigenspace generated by
                me \frac{x^i \diff x}{y^2},\,i=0,\ldots, 2g
                | and a negative eigenspace generated by
                me \frac{x^i \diff x}{y},\,i=0,\ldots, 2g-1
                |.

        p
            | We lift #[m p]-power frobenius to an endomorphism of #[m A^\dagger] by defining it as the canonical Witt vector frobenius on #[m \ZZ_q].
            me (a_0,a_1,\ldots)\mapsto (a_0^p, a_1^p,\ldots)
            | for #[m a_i\in \FF_q], then extend it to #[m \ZZ_q\lb x\rb ] by mapping #[m x\mapsto x^p].
            | Then since #[m y^2 = \tilde P(x)], we have
            me (y^\sigma )^2 = (y^2)^\sigma =(\tilde P(x))^\sigma 
            me = (\tilde P(x))^\sigma  \left(\frac{y^2}{\tilde P(x)}\right)^p = \frac{y^{2p} \tilde P(x)^\sigma }{\tilde P(x)^p}
            me y \mapsto y^p \left( \frac{\tilde P(x)^\sigma}{\tilde P(x)^p}\right)^{\frac 12}
            me    =      y^p \left(1 +  \frac{\tilde P(x)^\sigma - \tilde P(x)^p}{\tilde P(x)^p}\right)^{\frac 12}
            me    =      y^p \sum_{i=0}^\infty \binom{1/2}{i} \left(\frac{\tilde P(x)^\sigma - \tilde P(x)^p}{y^{2p}}\right)^i

        remark
            p
                | Here is why we removed the Weierstrass points (we don't want to divide by #[m y] and have things diverge).
                | Its possible to compute a Frobenius lift without deleting Weierstrass points, but then we need to solve for images of #[m x,y] using a 2 variable newton iteration.

        p
            | Further extend to differentials by sending
            me \diff x\mapsto \diff(x^p) = px^{p-1} \diff x
            | define #[m F_\ast = \sigma ^{\log_pq}] this is a lift of #[m q]-power frobenius.

        p
            | Key reduction lemmas, (to prove prop on eigenspaces).
        lemma
            statement: p
                | If #[m A(x) = \tilde P(x) B(x) + \tilde P'C(x)] then
                me \frac{A(x)\diff x}{y^2} = \left(B(x) + \frac{2C'(x)}{s-2}\right) \frac{\diff x}{y^{s-2}}
                | as elements of #[m H^1_{MW}(X)].

        p
            | We also  have
            me \diff(x^iy^j) = ix^{i-1}\diff x y^j  + x^i j y^{j-1} \diff y
            | , use #[m y^2 = \tilde P(x)] which implies
            me \diff(y^2 = \tilde P(x))= 2y \diff y = \tilde P'(x) \diff x
            me \implies \diff y = \frac{\tilde P'(x) \diff x}{2y}
            | giving
            me \diff(x^iy^j) = ix^{i-1}y^j\diff x   + x^i j y^{j-1} \frac{\tilde P'(x) \diff x}{2y}
            | .
        p
            | A special case of this: let #[m Q(x)  = x^{m-2g}] then
            me \diff(Q(x) y) = (Q(x) \tilde P'(x) + 2Q'(x) \tilde P(x)) \frac{\diff x}{y} \equiv  0 \text{ in }H^1_{MW} (X)
            | .

        p
            | Goal for Coleman integration: We compute
            me \left(\frac{x^i \diff x}{y}\right)^\sigma 
            | reduce using the above reductions to get a cohomologous differential that's a linear combination of the basis
            me \left\{ \frac{x^i \diff x}{y}\right\}_{i=0,\ldots, 2g-1}
            | .
        p
            | What does this look like?
            ol
                li
                    | The reduction process is essentially  subtracting the right linear combinations of #[m \diff(x^i y^j)] and using #[m y^2 = \tilde P(x)].
                li
                    | Precision is lost when we divide by #[m p] in the reduction algorithm, so we'll need to measure the loss of precision at each step to know how many provably correct #[m p]-adic digits we have.

        p
            | We compute
            me \left(\frac{x^i \diff x}{y}\right)^\sigma  = \frac{px^{pi + p - 1} \diff x }{y^p} \sum_{i=0}^L \binom{-1/2} i  \frac{(\tilde P(x) ^\sigma  - \tilde P(x)^p)^i}{y^{2pi}}
            | we need to know how large #[m L] must be to get provably correct expansions.

        p
            | If the result of this is
            me \sum_{j = - M}^N \frac{A_j(x) \diff x}{y^{2j+1}}
            | using the reduction formulas to eliminate the #[m j=N] term then the #[m N-1] term until no terms with #[m j \gt  0] remain.
            | Do likewise with the #[m j = -M, -M+1,\ldots] terms.

        p
            | At the end of the reduction algorithm we are left with
            me \left(\frac{x^i \diff x}{y}\right)^\sigma  = \diff f_i +  \sum_{j=0}^{2g-1} M_{ji} \frac{x^j \diff x}{y}
            | the #[m \diff f_i] is whats eliminated by the reduction algorithm, we sum the #[m \diff]'s at each step.

        p
            | Do this for each #[m i = 0, \ldots, 2g  -1].
            | Then #[m M = (M_{ij})] gives the matrix of Frobenius.
            | Its characteristic polynomial gives you the numerator of the zeta function of #[m X].
        p
            | Lemmas on precision:

        lemma
            statement: p
                | Let #[m A(x) \in \ZZ_q\lb  x\rb ] be a polynomial of degree #[m \le 2g].
                | For some #[m m \gt 0] consider the reduction of
                me \omega = \frac{A(x)\diff x}{y^{2m + 1}}
                | by Reduction 1
                me \omega = \frac{A(x)\diff x}{y^{2m + 1}} = \frac{B(x)\diff x}{y} + \diff f
                | with #[m B(x)\in \QQ_q\lb x\rb ] with #[m \deg B(x)\le 2g-1].
                | We have
                me p^{\floor*{\log_p(2m-1)}} B(x)\in \ZZ_q\lb x\rb 
                | .
                me f = \sum_{k = -1}^{m-1} \frac{F_k (x)}{y^{2k+1}},\,\deg F_k  \le 2g
                |.
        lemma
            statement: p
                | Let #[m A(x) \in \ZZ_q\lb  x\rb ] be a polynomial of degree #[m \le 2g].
                | For some #[m m \gt 0] consider the reduction of
                me \omega = \frac{A(x)y^{2m}\diff x}{y}
                | by Reduction 2
                me \omega = \frac{A(x)y^{2m}\diff x}{y} = \frac{B(x)\diff x}{y} + \diff f
                | with #[m B(x)\in \QQ_q\lb x\rb ] with #[m \deg B(x)\le 2g-1],
                me f = cy^{2m+1} + \sum_{k=0}^{m-1} F_k(x) y^{2k+1}
                | #[m c \in \QQ_q], #[m \deg  F_k \le 2g], #[m p^{\floor*{\log_p(2g+1)(2m+1)}} B(x)\in \ZZ_q\lb x\rb ]
                | .

        proposition
            statement: p
                | To get #[m N] correct digits in the expansion after reduction we need to start with precision
                me N_1 = N + \max \left\{   \floor*{ \log_p(2M -3)},\floor*{ \log_p(2g+1)}\right\} + 1 + \floor*{\log_p(2g-1)}
                | , where #[m M] is the smallest integer s.t.
                me M - \max\left\{ \floor*{\log_p(2M+1)},\floor*{\log_p(2g+1}) \right\}
                | .


        example
            statement: p
                | Let
                me y^2 = \tilde P(x) = x^3 + x+ 1/\QQ
                | let #[m p = 5] (or take this over #[m \FF_5] and lift to #[m \ZZ_5]).
                | Let #[m N = 2] be the number of correct 5-adic digits, so #[m M =3], so #[m N_1 = 3], use the differentials #[m \frac{\diff x}{y},\frac{x\diff x}{y}]
                me \left(\frac{\diff x}{y}\right)^\sigma = \left( \frac{25 x + 50}{y^{15}} + \frac{75 x^2 + 100x + 25 }{y^{13}} + \frac {50x^2 + 50x+100}{y^{11}} + \frac{75 x + 50}{y^9} + \frac{ 50x^2 + 50x }{y^7 } + \frac{70x^2 + 70 x +  25}{y^5} + \frac{5x}{y^3} \right)\diff x \pmod {5^3}
                | similar for 
                me \left(\frac{x\diff x}{y}\right)^\sigma = \left( \frac{100x^2 + 100x + 75}{y^{15}} + \cdots \right)\diff x \pmod {5^3}
                | let #[m F_k] be the polynomial in the term
                me \frac{F_k\diff x}{y^{2k +1}}
                | starting from #[m k = 7], set #[m s_k(x) = F_k(x)], compute a series of polynomials inductively for #[m k-1,k-2, \ldots, 0].
                | Given #[m S_{k+1}] find polynomials #[m A_{k+1}, B_{k+1}] s.t.
                me A_{k+1}\tilde P + B_{k+1} \tilde P ' = s_{k+1}
                | then set #[m s_k(x) = F_k(x)  + A_{k+1}(x) + \frac{2B'_{k+1}(x)}{2k+1}]
                me \left(\frac{\diff x}{y}\right)^\sigma = 15x \frac{\diff x}{y}\pmod {5^2}
                me \left(\frac{x\diff x}{y}\right)^\sigma = (22x+18) \frac{\diff x}{y}\pmod {5^2}
                me M = \begin{pmatrix} 0 \amp 18 \\ 15 \amp 22\end{pmatrix}\pmod{5^2}
                | .


        p
            | I missed a day heere!

        aside: p Lecture 7 1/10/2019

        p
            | Set-up for Tuitman's algorithm:
        p
            | #[m X]: Smooth projective curve #[m \FF_q], birational to
            me Q(x,y) = y^{d_x -1} + Q_{d_x - 1}y^{d_x-1} + \cdots + Q_0 = 0
            | is irreducible, where #[m Q_i \in \FF_q\lb x \rb]  for #[m i = 0 , \ldots, d_x -1].
            | This is part II of Tuitman #[xref(ref="bib-tuitman-map-to-p1-2")/] as we have a  not necessarily smooth model.
        p
            | Tuitman's idea:
            ol
                li
                    | Use the (low degree) map #[m x\colon  X\to \PP^1].
                li
                    | remove the ramification locus of #[m x], call this #[m r(x) = 0], c.f. Kedlaya's algorithm where we deleted the Weierstrass points.
                li Choose a lift of Frobenius that sends  #[m x] to #[m x^p]. Compute #[m y] via Hensel lifting.
                li Compute the action of Frobenius on differentials, reduce in cohomology, using Lauders fibration algorithm.

            | Then for a basis #[m \{\omega _i\}] of #[m H_\dR^1(X)] Tuitman's algorithm computes:
            me \phi ^* \omega _i = \diff f_i + \sum_j M_{ji} \omega _j
            | and as before this can be used to give an algorithm for Coleman integration #[xref(ref="bib-balakrishnan-tuitman")/].

        p
            | Let
            me S = \ZZ_q \lb x, 1/r\rb,\,R = \ZZ_q \lb  x, 1/r, y\rb /Q
            | where #[m Q] is a lift of #[m Q] to ##[m \ZZ_q] that is monic with same monomials in support.
            | This is possibly an issue for #[m g \ge 5], see Tuitmans paper.

            | See also #[xref(ref="bib-castryck-tuitman")/] for heuristics, possible solutions in higher genus.

        p
            | Let #[m V = \Spec S], #[m U = \Spec R].
            | The ring of overconvergent functions on #[m U] is
            me R^\dagger = \ZZ_q \langle x, 1/r, y\rangle^\dagger/Q

        p
            | Goal: compute a lift of Frobenius on #[m R^\dagger] in an explicit and fast way.

        p
            | Let #[m \FF_q(x,y)] denote the field of fractions of #[m R\otimes_{\ZZ_q} \FF_q] and #[m \QQ_q(x,y)] the field of fractions of #[m R\otimes _{\ZZ_q} \QQ_q].
        p
            | Assumption 0 : The polynomial #[m r(x)] is separable over #[m \FF_q], recall that
            me \Omega ^1_{R^\dagger} = \frac{R^\dagger \diff x \oplus R^\dagger \diff y}{\diff Q}
            | and if we write #[m \diff \colon  R^\dagger \to \Omega ^1_{R^\dagger}]
            | we have
            me H^1_{rig}(U) = \coker(\diff) \otimes \QQ_q
            |. #[xref(ref="bib-baldassarri-chiarallotto")/]
        p
            | We will compute #[m H^(X) \subseteq H^1(U)] ???????????????

        proposition
            statement: p
                | #[m R^\dagger] is a free module of rank #[m d_x] over #[m S^\dagger = \ZZ_q \langle x,1/r\rangle^\dagger].
                | A basis is
                me [1,y,\ldots, y^{d_x-1}]
                | .
        theorem
            statement: p
                | There is a lift of Frobeius #[m \phi ] on #[m R^\dagger] that sends #[m x] to #[m x^p].

        p
            | idea compute #[m \phi (y)] by Hensel lifting, using equation
            me Q^\sigma  (x^p, \phi (y))
            | note that this is possible since we've removed zeroes of 
            m \partder[Q]y
            |  from the curve by deleting #[m r(x)].

        p
            | After precomputing #[m \phi (y), \phi (y^2), \ldots , \phi (y^{d_x - 1})] and #[m \phi (1/r)] it is easy to compute #[m \phi ] on #[m R^\dagger, \Omega ^1_{R^\dagger}].
        proposition
            statement: p
                | Let #[m G \in M_{d_x \times d_x} (\ZZ_q \lb x, 1/r\rb )] denote the matrix s.t.
                me \diff(y^j) = \sum_{i=0}^{d_x-1} G_{i+1,j+1} y^i \diff x
                | for #[m j=0,\ldots, d_x-1].
                | then #[m G = M/r] where #[m M\in \Mat_{d_x \times d_x} ( \ZZ_q\lb x\rb )].
        p
            | Assumption 1: Let #[m W^0 \in \GL_{d_x}(\ZZ_q \lb x,1/r\rb )], #[m W^\infty \in \GL_{d_x}(\ZZ_q \lb x,1/x,1/r\rb )] be matrices such that if we denote
            me b_{j}^0 = \sum_{i=0}^{d_x-1} W_{i+1,j+1}^0  y^i
            me b_{j}^\infty  = \sum_{i=0}^{d_x-1} W_{i+1,j+1}^\infty  y^i
            | for all #[m 0 \le j \le d_x - 1].
            | Then #[m \{b_j^0 \}_{j=0}^{d_x-1}] is an integral basis for #[m \QQ(x,y) ] over #[m \QQ\lb x\rb ].
            |  #[m \{b_j^\infty  \}_{j=0}^{d_x-1}] is an integral basis for #[m \QQ(x,y) ] over #[m \QQ\lb 1/x\rb ].

        remark
            p
                | Magma can compute these integral bases.

        p
            | Once we compute the action of Frobenius on 1-forms we need to reduce, Tuitman uses Lauder's fibration algorithm.
            ol
                li
                    | Reduce pole order of points not lying over #[m \infty ].
                li
                    | Reduce pole order of points lying over #[m \infty ].

        p
            | Let #[m r'] denote #[m \diff r/ \diff x] for points not over #[m \infty ].
        proposition
            statement: p
                | For all #[m l\in \NN] and every #[m w \in \QQ_q\lb  x\rb ^{\oplus d_x}] there exist vectors #[m u,v\in \QQ_q\lb x\rb ^{\oplus d_x}] such that
                me \deg(v) \lt \deg(r)
                |and
                me \frac{\sum_{i=0}^{d_x-1} w_i b_i^0}{r^l} \frac{\diff x}{r} = \diff \left(\frac {\sum_{i=0}^{d_x-1} v_i b_i^0}{r^l} \right) + \left(\frac {\sum_{i=0}^{d_x-1} u_i b_i^0}{r^{l-1}} \right) \frac{\diff x}{r}
            proof: p
                | Since #[m r] is separable, #[m r'] is invertible in #[m \QQ_q\lb  x\rb /r] Check that there exists a unique solution #[m v] to the #[m d_x\times d_x] linear system.
                me \left( \frac{M}{r'} - l I\right)v \equiv  \frac{w}{r'} \pmod r
                | over #[m \QQ_q\lb x\rb /(r)].
                | Then take
                me u = \frac{w - (M - lr'I)v}{r} - \frac{\diff v}{\diff x}
                |.

        p
            | For points over infinity, similar proposition. ?????????

        theorem
            statement: p
                | Define the #[m \QQ_q]-vector spaces
                me E_0 = \left\{\left( \sum_{i=0}^{d_x-1} u_i(x) b_i^0\right)\frac{\diff x}r : u \in \QQ_q\lb x\rb ^{\oplus d_x}\right\}
                me E_\infty  = \left\{\left( \sum_{i=0}^{d_x-1} u_i(x,1/x) b_i^\infty \right)\frac{\diff x}r : u \in \QQ_q\lb x,1/x\rb ^{\oplus d_x}\right\}
                me B_0 = \left\{\sum_{i=0}^{d_x-1} v_i(x) b_i^0 : v\in \QQ_q[x]^{\oplus d_x}\right\}
                me B_\infty  = \left\{\sum_{i=0}^{d_x-1} v_i(x,1/x) b_i^\infty  : v\in \QQ_q[x,1/x]^{\oplus d_x}\right\}

                | then #[m E_0 \cap E_\infty ] and #[m \diff(B_0\cap B_\infty )] are finite dimensional #[m \QQ_q]-vector spaces and
                me H^1_{rig} (U)\simeq (E_0 \cap E_\infty )/\diff(B_0\cap B_\infty )
                | .
        theorem
            statement: p
                | There is an exact sequence
                me  0 \to H^1(X) \to H^1_{rig}(U) \xrightarrow{)(\res_0\oplus \res_\infty )  \otimes \QQ_q}

        aside: p Lecture 8 3/10/2019

        p
            |I lovingly stole this from Angus' notes, ty Angus.

        p: ol
            li: p
                | Determine a basis for cohomology.
                | We want to find #[m \omega_0, \ldots, \omega_{k-1} \in (E_0 \cap E_\infty)\cap \Omega^1(U)] such that
                ol
                    li
                        | #[m \{ \omega_0, \ldots, \omega_{k-1} \}] is a basis of
                        me H^1_\text{rig} \cong (E_0 \cap E_\infty) / d(B_0 \cap B_\infty)

                    li.
                        The class of every element of #[m (E_0 \cap E_\infty) \cap \Omega^1(U)] in #[m H^1_\text{rig}(U)] has #[m p]-adically integral coefficients with respect to #[m \{ \omega_0, \ldots, \omega_{k-1} \}].
                    li.
                        #[m \{ \omega_0, \ldots, \omega_{k-1} \}] is a basis for the kernel of #[m \res_0 \oplus \res_\infty] and hence for the subspace #[m H^1_\text{rig}(X)] of #[m H^1_\text{rig}(U)].

            li Compute lift of Frob #[m \phi], and compute the action of Frob on #[m \{ \omega_0, \ldots, \omega_{k-1} \}].

            li
                | Reduce pole orders so that we have
                me \phi^\ast \omega_i = df_i + \sum_j M_{ji} \omega_j
                | where
                me df_i = \underbrace{df_{i,0}}_{\text{finite pole reduction}} + \underbrace{df_{i,\infty}}_{\text{infinite pole reduction}} + df_{i,\text{end}}

        remark
            p: ol
                li.
                    Let #[m X] be a genus 3 smooth plane quartic, say #[m X = X_s(13)], the split Cartan curve of level 13.
                    Then #[m \dim H^1_\text{rig}(X) = 6], but #[m \dim H^1_\text{rig}(U) = 45 = 6 + 39], where #[m 39 = 3 \deg r(x)].

                li
                    | For applications to Coleman integrals between #[q good points], proceed as before
                    me \int_{\phi(P)}^{\phi(Q)} \omega_i = \int_P^Q \phi^\ast \omega_i
                    | and correct endpoints.

                li
                    | For Coleman integration from a #[em very bad point] (a point above #[m \infty] or a point with #[m x]-coordinate such that #[m r(x) = 0]) #[m B], split up the integral
                    me \int_B^Q \omega_i = \int_B^{B'} \omega_i + \int_{B'}^Q \omega_i
                    | for #[m B'] a point near the boundary of the residue disk of #[m B].

        paragraphs
            title Finite pole order reduction:

            p
                | For #[m i = 0, \ldots, 2g-1], find #[m f_{i,0} \in \mathcal R^\dagger \otimes \QQ_p] such that
                me \phi^\ast \omega_i = df_{i,0} + G_i \frac{dx}{r}
                | where #[m G_i \in \mathcal R \otimes \QQ_p] only has poles above #[m \infty].

        paragraphs
            title Infinite pole order reduction:

            p
                | For #[m i = 0, \ldots, 2g-1], find #[m f_{i,\infty} \in \mathcal R \otimes \QQ_p] such that
                me \phi^\ast \omega_i = df_{i,0} + df_{i,\infty} + H_i
                | where #[m H_i] only has poles at point #[m P] above #[m \infty], and #[m \ord_P(H_i) \geq (\ord_0 (W) - \deg r + 2) e_p] where #[m W = (W^0)^{-1} W^\infty] and #[m e_p] is the index of ramification of #[m x]-map at #[m P].

        paragraphs
            title Final reduction:

            p
                | For #[m i = 0, \ldots, 2g-1], find #[m f_{i, \text{end}} \in \mathcal R \otimes \QQ_p] such that
                me \phi^\ast \omega_i = \underbrace{df_{i,0} + df_{i,\infty} + df_{i,\text{end}}}_{= df_i} + \sum_j M_{ji} \omega_j
                | .

    subsection
        title Iterated Coleman Integrals

        p
            |Let #[m X / \QQ] be a smooth, projective curve, #[m p] a prime of good reduction.

        paragraphs
            title Goal:
            p Describe an iterated Coleman integral on #[m X_{\QQ_p}] and applications to rational points.

        p
            | Roughly speaking, an iterated Coleman integral is an iterated path integral
            me \int_P^Q \eta_n \ldots \eta_1 = \int_0^1 \int_0^{t_1} \ldots \int_0^{t_{n-1}} f_n(t_n) \ldots f_1(t_1) dt_n \ldots dt_1.

        paragraphs
            title Idea:
            p
                | Want to apply Kedlaya/Tuitman as before, by computing action of Frob and reducing to simpler integrals. Earlier we had
                me \int_P^Q df = f(Q) - f(P)
                | and now reduce #[m n]-fold integral to #[m (n-1)]-fold integral.

        paragraphs
            title Notation:
            p
                | #[m P,Q \in X(\QQ_p)], #[m \eta_1, \ldots, \eta_n] are 1-forms of the 2nd kind, without poles at #[m P,Q].
                me \eta_P^Q \eta_1 \ldots \eta_n = \int_P^Q \eta_1(R_1) \int_P^{R_1} \eta_2(R_2) \ldots \int_P^{R_{n-2}} \eta_{n-1}(R_{n-1}) \int_P^{R_{n-1}} \eta_n
                | for dummy variables #[m R_i].

    subsection
        title Algorithm for tiny iterated integral


        paragraphs
            title Input:
            p Points #[m P,Q \in X(\QQ_p)] in same residue disk.

        paragraphs
            title Output:
            p #[m \int_P^Q \eta_1 \ldots \eta_n]

        p: ol
            li Compute a local coordinate at #[m P], #[m (x(t), y(t))]

            li For each #[m k], write #[m \eta_k(x,y)] as #[m \eta_k(t)dt].

            li
                | Let #[m I_{n+1} = 1].
                | Compute for #[m k = n, n-1, \ldots, 2]
                me I_k = \int_P^{R_{k-1}} \eta_k I_{k+1} = \int_P^{t(R_{k-1})} \eta_k(t) I_{k+1} dt
                | where #[m t(R_{k-1})] is parameterising points in the residue disk of #[m P].

            li #[m \int_P^Q \eta_1 \ldots \eta_n = \int_P^{t(Q)} \eta_1(t) I_2(t) dt].

        p To compute more general iterated Coleman integrals, we'll use the following properties.

        proposition
            statement: p
                | Let #[m \omega_{i_1}, \ldots \omega_{i_n}] be forms of the second kind, regular at #[m P,Q \in X(\QQ_p)].
                ol
                    li #[m \int_P^P \omega_{i_1} \ldots \omega_{i_n} = 0]

                    li #[m \sum_{\text{all permutations }\sigma}  \int_P^Q \omega_{\sigma(i_1)} \ldots \omega_{\sigma(i_n)} = \prod_{j=1}^n \int_P^Q \omega_{i_j}]

                    li #[m \int_P^Q \omega_{i_1} \ldots \omega_{i_n} = (-1)^n \int_Q^P \omega_{i_n} \ldots \omega_{i_1}]

        corollary: statement: p.
            #[m \int_P^Q \omega_i \ldots \omega_i = \frac{1}{n!}\left( \int_P^Q \omega_i \right)^n]

        paragraphs
            title References
            p
                | For classical theory of iterated integrals
                ul
                    li K-T. Chen, Algebras of iterated path integrals and fundamental groups, Trans. of AMS 156 (1971) #[xref(ref="bib-chen")/]
                | For #[m p]-adic theory
                ul
                    li Coleman, Dilogarithms, regulators and #[m p]-adic #[m L]-functions, Invent. Math 1982 #[xref(ref="bib-coleman-dilogs")/].

                    li Coleman, de Shalit, #[m p]-adic regulators on curves and special values of #[m p]-adic #[m L]-functions, Invent. Math. 1988 #[xref(ref="bib-coleman-de-shalit")/]

                    li Besser, Coleman integration using the Tannakian formalism, Math. Ann. 2002 #[xref(ref="bib-besser-coleman-tannakian")/]

        remark: p.
            Still have linearity in the integrand, change of variables under rigid analytic maps.
            Be careful about additivity in endpoints.

        lemma: statement: p
            | Let #[m P, P', Q \in X(\QQ_p)].
            | Then
            me \int_P^Q \omega_{i_1} \ldots \omega_{i_n} = \sum_{j=0}^n \int_{P'}^Q \omega_{i_1} \ldots \omega_{i_j} \int_P^{P'} \omega_{i_{j+1}} \ldots \omega_{i_n}

        p For all algorithms, we'll restrict to the case #[m n=2] (double Coleman integrals).

        example: statement: p
            | Let #[m \phi(P), \phi(Q)] be images of #[m P, Q \in X(\QQ_p)] under Frobenius #[m \phi], then
            men#iteratedfrob \int_P^Q \omega_i \omega_k = \int_P^{\phi(P)} \omega_i \omega_k + \int_{\phi(P)}^{\phi(Q)} \omega_i \omega_k + \int_{\phi(Q)}^Q \omega_i \omega_k + \int_P^{\phi(P)} \omega_k \int_{\phi(P)}^Q \omega_i + \int_{\phi(P)}^{\phi(Q)} \omega_k \int_{\phi(Q)}^Q \omega_i

    subsection
        title Strategy for computing double Coleman integrals of words in #[m H^1_\text{dR}(X)]


        paragraphs
            title Input:
            p #[m \int_P^Q \omega_i \omega_j]

        p: ol
            li Compute #[m \phi(P)], #[m \phi(Q)]

            li
                | Compute action of Frob and do some linear algebra to simplify
                me \int_{\phi(P)}^{\phi(Q)} \omega_i \omega_j = \int_P^Q \phi^\ast(\omega_i) \phi^\ast(\omega_j)

            li Correct endpoints using equation #[xref(ref="iteratedfrob")].

        p: md
            mrow \int_{\phi(P)}^{\phi(Q)} \omega_i \omega_k  \amp= \int_P^Q \phi^\ast(\omega_i \omega_k)
            mrow \amp= \int_P^Q (\phi^\ast \omega_i)(\phi^\ast \omega_k)
            mrow \amp= \int_P^Q \left(df_i + \sum_j M_{ji} \omega_j\right)\left(df_k + \sum_j M_{jk} \omega_j\right)
            mrow \amp= \int_P^Q \left( df_idf_k + df_i \sum_j M_{jk}\omega_j + \sum_j M_{ji} \omega_j df_K + \sum_j M_{ji} \omega_j \sum_j M_{jk} \omega_j \right)
        aside: p Lecture 9 8/10/2019

        p
            | Last time: we were computing Coleman integrals
            me \int_{\phi (P)}^{\phi (Q)} \omega _i \omega _j = \int_P^Q \phi ^*(\omega _i \omega _j)
            me = \int_P^Q \diff f_i \diff f_k + \int_P^Q \sum_j M_{ji} \omega _j \diff f_k + \int_P^Q \diff f_i \sum_j M_{jk} \omega _j + \int _P^Q \sum_j M_{ji} \omega _j \sum_j M_{jk} \omega _j
            | expand each of the first three terms into expressions involving single Coleman integrals
            me \int_P^Q \diff f_i\diff f_k = \int_P^Q \diff f_i(R) \int_P^R \diff f_k = \int_P^Q \diff f_i(R) (f_k(R) - f_k(P)) = \int_P^Q f_k \diff f_i - f_k(P)(f_i(Q) - f_i(P))
            me \int_P^Q \sum M_{ji} \omega _j \diff f_k  = \int_P^Q \sum M_{ji} \omega _j(R) \int_P^R \diff f_k = \int_P^Q \sum M_{ji} \omega _j(R) (f_k(R) - f_k(P)) = \int_P^Q \sum _j f_k M_{ji} \omega _j - f_k(P)\int_P^Q \sum M_{ji} \omega _j
            me \int_P^Q \diff f_i \sum_j M_{jk} \omega _j = \int_P^Q \diff f_i(R) \int_P^R \sum M_{jk} \omega _j
            me = f_i(R) \int_P^R \sum_j M_{jk} \omega _j | - \int_P^Q f_i(R) \left( \sum M_{jk} \omega _j(R\right))
            me = f_i(Q) \int_P^Q \sum_j M_{jk} \omega _j - \int_P^Q f_i \sum M_{jk} \omega _j
            | then collect terms
            | If #[m c_{ik}] is the sum of the expanded above, then the vector of double coleman integrals is a solution of a linear system involving all of the above.

        paragraphs
            title Application (preview)
            p
                | Let #[m \mathcal E/\ZZ] be the minimal regular model of an elliptic curve, and let #[m \mathcal X = \mathcal E - 0].
                | Let
                me \omega _0 = \frac {\diff x}{2y + a_1 x + a_3},\,\omega _1 = x\omega _1
                | in Weierstrass coordinates, let #[m b] be #[m 0] (really a tangential base-point at #[m 0]).
                | Or an integral 2-torsion point.
                | Let #[m p] be an odd prime of good reduction, suppose #[m \mathcal E] has analytic rank 1, and Tamagawa product 1.
            p
                | Consider
                me \log(z) = \int_b^z \omega _0,\,D_2 (z) = \int_b^z \omega _0 \omega _1
                | , can think of #[m \log] as extending the log in the formal group.
            theorem
                title Kim '10, B.-Kedlaya-Kim '11
                statement: p
                    | Suppose #[m P] is a point of infinite order in #[m \mathcal E(\ZZ)] then #[m \mathcal X(\ZZ) \subseteq \mathcal E(\ZZ)] is in the zero set of
                    me f(z) = (\log(P))^2 D_2(z) - (\log(z))^2 D_2(P)
                    | .


        paragraphs
            title Chabauty-Coleman wrap up
            p
                | What if Coleman's bound
                me \# X(\QQ) \le \# X(\FF_p) +2g-2
                | is larger than #[m \#X(\QQ)_{\text{known}}].
                | If we carry out Chabauty-Coleman, what can we do if we seem to find #[q extra] #[m p]-adic points that don't look like they live if #[m X(\QQ)]?
            p
                | Try using the Mordell-Weil sieve (developed by Scharashkin in his thesis 99, adapted by Flynn ('04), Poonen-Schaefer-Stoll 07, Bruin-Stoll.
                | See #[xref(ref="bib-bruin-stoll-mw,bib-siksek-mw")/].

            p
                | Set-up
                me X/\QQ
                | a curve of genus #[m g \ge 2], #[m M \gt 0] an integer
                me i\colon  X\hookrightarrow J
                | suppose #[m c_M \subseteq J(\QQ)/MJ(\QQ)] is a set of residue classes for which we want to show that no rational point #[m P \in X(\QQ)] maps to #[m c_M] under #[m \pi \circ i].

            p
                | Simplest case: pick a good prime #[m v]
                me.
                    \xymatrix{X(\QQ) \ar[r]\ar[d] &amp; J(\QQ)/MJ(\QQ) \ar[d]\\ X(\FF_v) \ar[r] &amp; J(\FF_v)/MJ(\FF_v)}
                | if #[m \alpha _v(c_M) \cap \beta _v(X(\FF_v)) = \emptyset] then done.
                | Typically this is not enough:
                | More generally consider set #[m S] of good primes and the commutative diagram
                me.
                    \xymatrix{X(\QQ) \ar[r]\ar[d] &amp; J(\QQ)/MJ(\QQ) \ar[d]\\ \prod_v X(\FF_v) \ar[r] &amp; \prod_v J(\FF_v)/MJ(\FF_v)}
                | then it suffices to show that #[m \alpha _s(c_M) \cap \beta _s(\prod_v X(\FF_v)) = \emptyset].

            p
                | The goal is then to find a good set of #[m S] s.t.
                me A(S, c_M) = \left\{c\in c_M : \alpha _S(c) \in \beta _s(\prod_v X(\FF_v))\right\}
                | is empty.
            p
                | Heuristically the size of #[m A(S,c_M)] is as follows:
                | For a good prime
                me X_{M,v} = \beta _v(X(\FF_v))
                me \gamma (v,M) = \frac{\# X_{M,v}}{\#J(\FF_v)/ M(J(\FF_v))}
                | Note : #[m v] is only useful if #[m \gamma (v,M) \lt 1].
            p
                | Expected size of #[m A(S, M)] is
                me \#c_M \prod_c \gamma (v, M)
                | want this to be small.
            p
                | Difficulties in using the sieve, the set, #[m A(S, c_M)] can be large.
                | The computation of images of #[m X(\FF_v)] in #[m J(\FF_v)] can become infeasible (the computation requires #[m v] discrete logs in #[m J(\FF_v)]). Can be mitigated by using primes for which #[m \#J(\FF_v)] is sufficiently smooth.
            p
                | Two variations on Chabauty-Coleman:
                | Pass to a collection of covering curves, (difficulty: constructing covers)
                | Elliptic Chabauty method: (difficulty computing #[m E(K)] for #[m K/\QQ] a larger degree number field.
            p
                | These methods can potentially compute #[m X(\QQ)] when #[m \rk J(\QQ) \ge g].
            theorem
                title Chevalley-Weil
                statement: p
                    | Let #[m f \colon Y\to X] be an unramified morphism of curves #[m /\QQ] then there is a computable finite extension #[m K/\QQ] such that
                    me f\inv(X(\QQ))  \subseteq Y(K)
                    | .

            theorem
                title Wetherell '97
                statement: p
                    | There is a finite set of unramified covering curves #[m Y_i \to X] over #[m \QQ] (all isomorphic  over #[m \overline\QQ]), such that
                    me X(\QQ) \subseteq \bigcup_{i=1}^n f_i(Y_i(\QQ))
                    | .
            remark: p
                | When #[m X] is an elliptic curve this is descent in the proof of the Mordell-Weil theorem.

    subsection
        title Introduction to #[m p]-adic heights

        aside: p Lecture 11 17/10/2019

        p
            | The theory of #[m p]-adic heights has developed over 20 years, with work due to Bernardi, Neron, Schneider, Perrin-Riou, Mazur, Tate, Zarhin, Iovita, Werner, Coleman, Gross, Nekovar.

        p
            | We will begin with #[m  p]-adic heights on elliptic curves.
            | Let #[m E/\QQ] be an elliptic curve, then a #[m p]-adic height #[m h] is a function
            me h\colon  E(\overline \QQ) \to \QQ_p
            | that plays a similar role to the canonical height
            me \hat h E(\overline \QQ) \to \RR
            | .
        p
            | Let #[m p\ge 5] be a prime of good ordinary reduction for #[m E].
            | Let #[m 0\ne P \in E(\QQ)], then write
            me P = (x(P), y(P))= \left( \frac{a(P)}{d(P)^2},\frac{b(P)}{d(P)^2}\right)
            | and assume #[m (a(P),d(P)) = (b(P),d(P))  = 1] and #[m d \ge 1].
            | #[m d(P)] is the denominator of #[m P].
        p
            | Suppose #[m P] satisfies two conditions
            ol
                li
                    p #[m P] reduces to #[m 0] in #[m E(\FF_p)].
                li
                    p #[m P] reduces to a non-singular point of #[m E(\FF_l)] for all bad primes #[m l].
        p
            | 1. Implies #[m E(P) = -x(P)/y(P)] is divisible by #[m P].

        definition
            statement: p
                | Let #[m E/\QQ] and #[m p \ge 5] be good ordinary, the cyclotomic #[m p]-adic height #[m h] on such points #[m P] in #[m E(\QQ)] is
                me h(P) = \frac 1p \log_p\left(\frac{\sigma (P)}{d(P)}\right)
                | . #[m \sigma (P)] is the #[m p]-adic sigma function associated to #[m E/\ZZ_p].

        p
            | What is #[m \sigma (P)]?
        p
            | Mazur-Stein-Tate #[q Computation of p-adic heights and log convergence], Doc. Math 2006.
            | Mazur-Tate #[q The            p-adic sigma function             ], Duke 1991.
            | Mazur-Tate gave 11 different characterizations of the #[m p]-adic sigma function.
            | We'll describe one characterization, let
            me x(t) = t^{-2} + \cdots \in \ZZ_p ((t))
            | be #[m x] in the formal group of #[m E/\ZZ_p], then
            me y(t) = t^{-3} + \cdots \in \ZZ_p ((t))
            | (Silverman AEC, Ch IV).

        theorem
            title Mazur-Tate
            statement: p
                | There is exactly on odd function
                me \sigma (t) = t + \cdots \in t \ZZ_p\lb \lb t\rb \rb
                | and constant #[m c\in \ZZ_p] that together satisfy the #[m p]-adic differential equation
                me x(t) + c = \frac{-\diff}{\omega }\left(\frac 1\sigma  \frac {\diff \sigma }{\omega }\right)
                | #[m \omega ] is the invariant differential associated to a chosen Weierstrass model for #[m E]
                me \omega  = \frac{\diff x}{2y + a_1x + a_3}
                |and
                me c = \frac{a_1^2 + 4a_2 - E_2(E,\omega )}{12}
                | we'll say more about #[m E_2(E, \omega )] in a bit!
        lemma
            statement: p
                | The height function #[m h] extends uniquely to the full Mordell-Weil group #[m E(\QQ)] and satisfies #[m h(nQ) = n^2 h(Q)] for all #[m n\in \ZZ], and #[m Q\in E(\QQ)] for #[m P,Q \in E(\QQ)] setting
                me (P,Q) = h(P) + h(Q) - h(P+Q)
                | we get a pairing on #[m E(\QQ)].
        p
            | To compute #[m h(Q)] for arbitrary #[m Q\in E(\QQ)].
            | Let #[m n_1 = \#E(\FF_p)], #[m  n_2 = \lcm_v(\{c_v\})], let #[m n = \lcm(n_1,n_2)] then #[m P=nQ] satisfies 1) and 2) from earlier.
            | So compute #[m h(P) = h(nQ)] and then
            me h(Q) = \frac{1}{n^2 } h(nQ) = \frac{1}{n^2} h(P)
            | .
        remark: p The #[m p]-adic regulator #[m \Reg_p] of #[m E/\QQ] is the determinant of the matrix of pairings on #[m E(\QQ)/E(\QQ)_{\text{tors}}].

        conjecture
            title Schneider '82
            statement: p
                | The (cyclotomic) height pairing is non-degenerate, equivalently #[m \Reg_p] is non-zero.

        p
            | Contrast with canonical height #[m \hat h(P) = 0 \iff P] is torsion

        remark: p This #[m p]-adic regulator fits into a #[m p]-adic BSD conjecture.

        conjecture
            title Special case of Mazur-Tate-Teitelbaum, '86, Inventionnes
            statement: p
                | Suppose #[m E] has good ordinary reduction at #[m p], let #[m \mathcal L_p(E,T)] be the #[m p]-adic #[m L]-function attached to #[m E/\QQ].
                ol
                    li
                        me \ord_{T=0} \mathcal L_p(E,T)=\rk E(\QQ)
                    li
                        me \mathcal L_p^* (E,0) =\frac{ \epsilon_p \prod c_v  |\Sha(E/\QQ)|\Reg_p}{\#E(\QQ)_{\text{tors}}^2}
                        | the leading coefficient.
                | #[m \epsilon _p = (1-\alpha \inv)^2] where #[m \alpha  ] is the unit root of #[m x^2  - a_p x + p=0].
        remark
            p
                | See also Stein-Wuthrich, #[q Algorithms for the arithmetic of elliptic curves using Iwasawa theory], Math. Comp. 2013.

        p
            | Back to #[m E_2 (E,\omega )], Katz '73, gave an interpretation of #[m E_2(E,\omega )] as a direction of the unit-root eigenspace of frobenius acting on Monsky-Washnitzer cohomology.
            | Suppose #[m E \colon  y^2 = f(x)], then the basis for
            me H^1_{\dR}(E) = H^1_{MW}(E')^-  = \left\{ \frac{\diff x}{y},\frac{x\diff x}{y}\right\}
            | moreover #[m H^1_{\dR}(E) = H^0(E, \Omega ^1) \oplus U] with #[m U] the unit root subspace.
            | Compute the matrix of #[m p]-power frobenius #[m F], want to find a basis for #[m U].
            | We know that
            me F\left(\frac{\diff x}{y}\right)  \in p H^1_{\dR}(E)
            | so that #[m \mod {p^n}], #[m U] is the span of #[m F^n \left(\frac{x\diff x}{y}\right)] so for each #[m n] write
            me F^n\left(\frac{x\diff x}{y}\right) = a_n \frac{\diff x}{y} + b_n \frac{x\diff x}{y}
            | then #[m E_2(E,\omega )  = -12 \frac{a_n}{b_n} \pmod{p^n}].

        p
            | What does this have to do with rational/integral points on #[m E]?
            me E\colon  y^2 = f(x)
            | Recall
            me x + c = \frac{-\diff}{\omega }
            | in formal group
            me \implies \omega (x+c) = - \diff \left(\frac 1 \sigma  \frac{\diff \sigma }{\omega }\right)
            me \implies \int \left(\frac{x\diff x}{y } + \frac{c\diff x}{y} \right)  = -\frac{\diff \sigma }{\sigma \omega } = \frac{\diff}{}.


        aside: p Lecture 1? 22/10/2019


        p
            | #[m p]-adic heights after Coleman-Gross, #[q p-adic heights on curves] 1989.
        p
            | Let #[m X/\QQ] be a smooth projective curve of genus #[m g \ge 1] and #[m p] a prime of good reduction for #[m X] and ordinary reduction for #[m J].
            | We'll be thinking of #[m X/\QQ_p = K].
        p
            | Important: fix a subspace of #[m H^1_{\dR}(Y_{/K})] complementary to  #[m H^0(X, \Omega ^1_{X/K})] call this #[m W].
            | #[m H^1_{\dR}(X_{/K}) = H^0(X, \Omega _{X}^1)  \oplus W].
        p
            | We'd like to understand the #[m p]-adic height of two degree 0 divisors #[m D_1,D_2].
            | Assume #[m D_1, D_2\in \Div^0(X)] have disjoint support.
        definition
            statement
                p
                    | The cyclotomic #[m p]-adic height is a symmetric bilinear pairing
                    me h \colon  \Div^0(X) \times \Div^0(X) \to \QQ_p
                    me (D_1,D_2)\mapsto h(D_1, D_2)
                    | disjoint support.
                p
                    | where
                    ol
                        li
                            me h(D_1,D_2)  = \sum_v h_v(D_1,D_2) = h_p(D_1,D_2) + \sum_{v\ne p} h_v(D_1,D_2)
                            me =\int_{D_2} \omega _{D_1} + \sum_{v\ne p }m_v \log_p(v)
                            | with the left term a coleman integral of the third kind and #[m m_v] some intersection multiplicities.
                        li
                            me h(D, \div(\beta )) = 0
                            | for #[m \beta \in \QQ(X)^\times], so #[m h] is well defined on #[m J \times J].

        remark
            p
                | The local heights can be extended non-uniquely to give the self-pairing
                me h(D,D) = \sum h_v(D,D)
                | this needs a choice of tangent vector at each point in the support of #[m D].
        remark
            p
                | The local height at #[m p] is a Coleman integral of a normalized differential w.r.t. #[m W] of the third kind.

        p
            | e.g. if
            me X\colon  y^2 = f(x)
            | is a hyperelliptic curve
            me D_1 = (P) - (Q),\,P,Q\in X(\QQ),\,y(P),y(Q) \ne 0
            | can we construct #[m \omega ] with #[m \Res(\omega ) = D_1]?
            | We want residue 1 at #[m P] and -1 at #[m Q].
            | So #[m \omega ] has simple poles at #[m P,Q].
            | e.g.
            me \omega  = \frac{\diff x}{2y}\left(\frac{y+y(P)}{x-x(P)}  - \frac{y + y(Q)}{x-x(Q)}\right)
            | has #[m \Res(\omega ) = D_1].
            | But there are lots more!

        p
            | Recall: #[m H^1_{\dR}(X)] has a canonical non-degenerate form given by cup-product pairing
            me H^1_{\dR} (X/K) \times H^1_{\dR}(X/K) \to K
            me ([\mu _1],[\mu _2]) \mapsto [\mu _1] \cup [\mu _2]
            | where
            me [\mu _1] \cup [\mu _2] = \sum_Q \Res_Q\left( \mu _2\int \mu _1\right)
            | note that #[m \mu _1,\mu _2] are differentials of the second kind (residue 0).
            | So the residue does not depend on the choice of local integral for #[m \mu _1] since #[m \mu _2] has no residue at any point.
        p
            | Let #[m T(K)] be the space of differentials of the third kind on #[m X], at most simple poles, integer residues.
            | We have a residue divisor hom
            me \Res \colon T(K) \to \Div^0(X)
            me \omega \mapsto \Res(\omega ) = \sum_p \Res_p \omega 
            | we have the short exact sequence
            me 0\to H^0(X, \Omega _X^1) \to T(K) \xrightarrow{\Res}\Div^0(X) \to 0
            | .
            | We're interested in #[m T_l(K)] these are log differentials
            me \frac{\diff f}{f},\,f\in K(X)^\times
            | .
        p
            | Since
            me T_l(K) \cap H^0(X, \Omega ^1_{X/K}) = \{0\}
            | and #[m \Res(\diff f / f) = \divisor (f)] we get from the above sequence
            me 0\to H^0(X, \Omega _X^1) \to T(K)/T_l(K) \to J(K)\to 0

        proposition
            statement: p
                | There is a canonical homomorphism
                me \Psi \colon T(K)/T_l(K) \to H^1_{\dR}(X)
                | .

        p
            | Note: #[m \Psi] is the identity on differentials of the first kind.
            | #[m \Psi] sends third kind differentials to second kind or exact differentials.
            | #[m \Psi] sends log differentials to 0.

        definition
            statement: p
                | Let #[m D \in \Div^0(X)] then #[m \omega _D] is the unique form of the third kind with
                me \Res(\omega _D) = D
                | and
                me \Psi(\omega _D)\in W
                | recall we fixed
                me H^1_\dR(X) = H^0(X, \Omega _X^1) \oplus W
                | .

        definition
            statement: p
                | The local height at #[m p] of #[m D_1,D_2] is
                me h_p(D_1,D_2) = \int_{D_2} \omega _{D_1}
                |.

        remark
            p
                | When #[m X] has good reduction and #[m J] has ordinary reduction then there is a canonical choice for #[m W], the unit root subspace for the action of frobenius.

        proposition
            statement: p
                | If #[m \{\omega _{0}, \ldots, \omega _{2g-1}\}] is a basis for #[m H^1_{\dR}(X)] with #[m \{\omega _0, \ldots, \omega _{g-1}\}\subseteq H^0(X, \Omega ^1)].
                | Then
                me \{ (\phi ^*)^n \omega _g, \ldots,  (\phi ^*)^n \omega _{2g-1}\}
                | is a basis for #[m W] mod #[m p^n] where #[m \phi ] is a lift of frobenius.


        algorithm
            title Coleman integral of differential of the third kind, with poles in non-weierstrass disks
            statement: p
                | Input: #[m \omega ] with #[m \Res(\omega ) = (P) - (Q)]. #[m P,Q\in X(\QQ)] non-weierstrass.
                | #[m R,S\in X(\QQ_p)], #[m R,S\not\in \operatorname{disk}(P),\operatorname{disk}(Q)].
                | Output:
                me \int_S^R \omega 
                ol
                    li
                        | Compute #[m \Psi (\omega ) \in H^1_{\dR}(X)].
                        | Let #[m \phi ] be a lift of Frobenius.
                        | Let #[m \alpha  = \phi ^* \omega  - p\omega ].
                        | Use #[m \Psi (\omega )] and frobenius equivariance.
                        | We have
                        me \Psi (\alpha ) = \Psi (\phi ^* \omega  - p\omega ) 
                        me                = \Psi (\phi ^* \omega)  -\Psi ( p\omega )
                        me                = \phi ^* \Psi (\omega)  -p\Psi (\omega )
                    li
                        | Let #[m \beta ] be a 1-form with #[m \Res(\beta ) = (R)- (S)].
                        | Compute #[m \Psi (\beta )].
                    li
                        | Compute #[m \Psi (\alpha ) \cup \Psi (\beta )], easy since both are elements in #[m H^1_{\dR}] that we just computed.
                    li
                        | Compute
                        me \int_{\phi (S)}^S \omega 
                        | and
                        me \int_R^{\phi (R)} \omega 
                        | tiny

                    li
                        | Compute
                        me \sum_A \Res_A (\alpha \int \beta )
                        | .
                    li
                        me \int_S^R \omega  = \frac{1}{1-p} \left(\Psi (\alpha ) \cup \Psi (\beta ) + \sum_A \Res_A(\alpha \int \beta ) - \int_{\phi (S)}^S \omega  - \int_R^{\phi (R)} \omega \right)


        remark
            p
                | Idea behind this algorithm is that #[m \alpha ] is almost of the second kind, in that the sum of the residues of #[m \alpha ] in each annulus is 0.

        algorithm
            title Local height at #[m p]
            statement: p
                | Output: #[m h_p(D_1,D_2)].
                ol
                    li
                        | Let #[m \omega ] be a differential in #[m T(K)] with #[m \Res(\omega ) = D_1].
                    li
                        | Compute #[m \Psi (\omega ) = \sum_{i=0}^{2g-1} a_i\omega _i \in H^1_\dR(X)].
                        | Then
                        me \Psi (\omega ) - \sum_{i=0}^{g-1} a_i\omega _i  \in W
                        | let #[m \omega _{D_1} = \omega  - \sum_{i=0}^{g-1} a_i \omega _i].
                    li
                        | Compute using the previous algorithm
                        me h_p(D_1,D_2) = \int_{D_2} \omega _{D_1}
                        | .
        p
            | More details in Balakrishnan-Besser #[q computing local p-adic heights on hyperelliptic curves]. IMRN 2012.
        p
            | What if #[m D_1] and #[m D_2] have common support?
            | e.g. #[m h_(D,D)].

        p
            | The local height at #[m P] would be
            me h_p(D,D) = \int_D \omega _D
            | ideal of Gross #[q local heights on curves] Arithmetic Geometry '86.

        p
            | At each point #[m x] in the common support of your divisors, choose a basis #[m t,t_x] for the tangent space.
        p
            | Let #[m z = z_\infty ] be a uniformizer at #[m x]
            me \partial _t z = 1
            | any function
            me f \in K(X)^\times
            | then has a well-defined #[q value] at x
            me f[x]  = \frac{f}{z^m}(x)
            | where #[m m = \ord_x(f)].
            | This depends only on #[m t] and not #[m z].
            | To do this for local p-adic heights use Besser's p-adic Arakelov theory, JNT 2005.
        p

            | Balakrishnan-Besser Coleman-Gross height pairings and p-adic sigma function, Crelle, 2015.

        proposition
            statement: p
                | Let #[m X/\QQ] be a hyperelliptic curve with odd degree model monic.
                me D = (P) - (\infty )
                me h(D,D) = \cancel{``\int_D \omega _D''}
                me = \int_{i=0}^{g-1} \int_\infty ^P \omega _i\overline \omega _i
                | #[m \omega _i] self dual basis for cup.

        aside: p Lecture 1? 29/10/2019

        p
            | How do we use local heights on Jacobians of curves to study integral points.
        theorem
            title Quadratic Chabauty for integral points on hyperelliptic curves B.-Besser-Muller
            statement: p
                | Let #[m f(x) \in \ZZ\lb x\rb ] be monic separable polynomial of degree #[m 2g+1 \ge 3], that does not reduce to a square modulo #[m q] for any prime #[m q]. (in the paper monic is not used, this condition then restricts the reduction type)
                | Let #[m U  = \Spec (\ZZ\lb x,y\rb  /(y^2 - f(x)))] and let #[m X] be the normalization of the proj closure of the generic fiber of #[m U].
                | Let #[m J] be the Jacobian on #[m X] and assume #[m \rk J(\QQ) = g], choose a prime #[m p] of good ordinary reduction.
                | Suppose that the #[m p]-adic coleman integrals
                me f_i(z) = \int_\infty ^z \omega _i = \int_\infty ^z \frac{x^i \diff x}{2y}
                | then there exists  explicitly computable constants #[m \alpha _{ij} \in \QQ_p] s.t. the locally analytic function
                me \rho (z) = \theta(z) - \sum_{0\le i \le j \le g-1 } \alpha _{ij} f_i(z) f_j(z)\text,
                | where #[m \theta(z) = h_p((z) - (\infty ),(z) - (\infty ))] is an extension of the Coleman-Gross local height at #[m p] which takes values in
                me \mathcal U(\ZZ\lb 1/p\rb )
                | in an effectively computable finite set #[m S\subseteq \QQ_p].
        p
            | Refs, Balakrishnan, Jennifer S., Amnon Besser, and J. Steffen Müller. “Quadratic Chabauty: P-Adic Heights and Integral Points on Hyperelliptic Curves.” Journal Für Die Reine Und Angewandte Mathematik (Crelles Journal) 2016, no. 720 (January 1, 2016). https://doi.org/10.1515/crelle-2014-0048.
            | Balakrishnan, Jennifer S., Amnon Besser, and J. Steffen Müller. “Computing Integral Points on Hyperelliptic Curves Using Quadratic Chabauty.” Mathematics of Computation 86, no. 305 (October 12, 2016): 1403–34. https://doi.org/10.1090/mcom/3130.
            | Müller, Jan Steffen. “Computing Canonical Heights Using Arithmetic Intersection Theory.” Mathematics of Computation 83, no. 285 (2014): 311–336. https://doi.org/10.1090/S0025-5718-2013-02719-6.

        proof
            p
                | Sketch:
                | Recall the Coleman-Gross #[m p]-adic height for #[m X/\QQ] is a symmetric bilinear pairing  
                me h \colon J(\QQ) \times J(\QQ) \to \QQ_p
                | the global height decomposees as a sum of local heights
                me h(D_1,D_2) = \sum_{v} h_v(D_1,D_2)
                | in particular we have
                me h(D_1, D_2) = h_p(D_1,D_2) + \sum_{v\ne p} h_v(D_1,D_2)
                me   =\int_{D_2} \omega _{D_1} + \sum_{v\ne p} h_v(D_1,D_2)
                | where #[m \omega _{D_1}] is a normalized differential of the 3rd kind (depends on a splitting of the Hodge filtration on #[m H^1_\dR(X/\QQ_p)]) and for #[m v\ne p]
                me h_v(D_1,D_2) = m_v \log_p v,\,m_v\in \QQ
                | computed using arithmetic intersection theory.
                | See Muller and:
                | Bommel, Raymond van, David Holmes, and J. Steffen Müller. “Explicit Arithmetic Intersection Theory and Computation of Néron-Tate Heights.” Mathematics of Computation, 2019. https://arxiv.org/abs/1809.06791v1.

            p
                | Then look at #[m h = h_p + \sum_{v \ne p} h_v] note
                ol
                    li
                        | #[m h] is a quadratic form, so can be written in terms of a basis of space of quadratic forms for #[m J(\QQ)] and this can be done using Coleman integrals.
                        me h(z-\infty , z-\infty ) = \sum \alpha _{ij} f_i(z) f_j(z)
                        | ,
                    li
                        | #[m h_p] is a locally analytic function and in the extension to self-pairing:
                        me h_p(z-\infty , z-\infty ) = -2\sum_{i=0}^{g-1} \int_\infty ^z \omega _i\bar \omega _i,\,\omega _i = \frac{x^i \diff x}{2y},\,\bar\omega _i\text{ cup product duals}
                        | .

                    li
                        | The sum
                        me \sum_{v\ne p} h_v(z-\infty ,z-\infty )
                        | takes on finitely many values in #[m S] when restricted to #[m p]-integral points.
                        | The set #[m S] can be computed by knowing the reduction of #[m X] at bad primes.
                    li
                        | Then rewrite
                        me h- h_p  \in \{ \sum_{v\ne p} h_v \} = S
                    li
                        | this #[m \rho ] can be computed as a convergent power series in each residue disk.
                        | So now pretend we are working in classical chabauty Coleman.
                        | Expand #[m \rho ] in each disk, set equal to each value in #[m S] solve for all #[m t \in U(\ZZ_p)] s.t. #[m \rho (z) \in Z].
                        | Take all such points call that #[m X(\ZZ_p)_2].
                    li
                        | It's possible that #[m X(\ZZ_p)_2] is strictly larger than the known points in #[m U(\ZZ)].
                        | In this case run 1-4 on a collection of good ordinary #[m p] and run Mordell-Weil sieve.


            p
                | More details on each step
                ol
                    li
                        | Let #[m D_1, \ldots, D_g \in \Div^0(X)] representing basis elements of #[m J(\QQ)\otimes \QQ] then compute global height pairings.
                        | #[m h(D_i ,D_j)] using B.-Besser-Muller.
                        | A basis for spaces of bilinear forms on #[m J(\QQ)] is
                        me \frac12(f_kf_l + f_l f_k)
                        | so compute
                        me \frac12(f_k(D_i)f_l(D_j) + f_l(D_i) f_k(D_j))
                        | do linear algebra to compute
                        me \alpha _{k,l}
                        me h(D_i,D_j)  = \sum \alpha _{k,l} ( \frac12(f_k(D_i)f_l(D_j) + f_l(D_i) f_k(D_j)))
                    li: p
                        | Want to compute
                        me \{ \bar\omega _i\}
                        | for #[m 0\le 1 \le g-1] such that #[m \lb  \bar \pi _i \rb  \cup \lb \omega _j \rb  = \delta _{ij}]
                        ol
                            li
                                | Compute splitting of
                                me H^1_\dR(X/\QQ_p) = H^0(X, \Omega ^1_X) \oplus W
                                |, where #[m W] is the unit root eigenspace of frob,
                                | recall that modulo #[m p^n] a basis for #[m W] is
                                me \{(\phi ^*)^n \omega _g, \ldots, (\phi ^*)^n\omega _{2g-1}\}
                            li
                                | Let #[m \tilde \omega _j] be a projection of #[m \omega _j ] onto #[m W] along #[m H^0(X, \Omega ^1)].
                                | i.e.
                                me \tilde \omega _j = \omega _j - \sum_{i=0}^{g-1} a_i \omega _i
                                | .
                            li
                                | use cup product matrix to compute
                                me \bar\omega _0=\sum_{i=g}^{2g-1} b_{0i} \tilde \omega _i
                                me \vdots
                                me \bar\omega _{g-1}=\sum_{i=g}^{2g-1} b_{g-1,i} \tilde \omega _i
                                | then let
                                me \theta (z)  = -2\sum_{i=0}^{g-1} \int \omega _i \bar \omega _i
                                | to compute this as a power series in each residue disk for each residue disk compute a #[m \ZZ_p] point #[m P], the value #[m \theta (P)] local coordinate #[m z_P] at #[m P].
                                me \theta (z) =-2 \sum_{i=0}^{g-1} \int_{\infty }^z \omega _i \bar \omega _i
                                me = -2 \left(\sum_{i=0}^{g-1} \int_\infty ^{P} \omega _i \bar \omega _i + \sum_{i=0}^{g-1} \int_P^{z_P} \omega _i \bar \omega _i + \sum_{i=0}^{g-1} \int_P^{z_P} \omega _i \int_{\infty }^P \bar \omega _i\right)
                                me = \theta (P) - 2\left(\sum_{i=0}^{g-1} \int_P^{z_P} \omega _i \bar \omega _i + \sum_{i=0}^{g-1} \int_P^{z_P} \omega _i \int_{\infty }^P \bar \omega _i\right)
                    li
                        | Prop.
                        | There is  a proper regular model #[m \mathcal X ] of #[m X\otimes \QQ_q] over #[m \ZZ_q] (#[m q\ne p]) such that if #[m \mathcal X] is #[m p]-integral then
                        me h_q((x) -(\infty ),(x)-(\infty ))
                        | depends solely on the component of the special fibre #[m \mathcal X_q] that the section in #[m \mathcal X(\ZZ_z)] corresponding to #[m x] intersects.

                        | e.g. in #[m g =2] special fibres have been classified by Namikawa-Ueno and if #[m \mathcal X] is semistable then the types are
                        me \lb I_{n_1} - I_{n_2} - m\rb  \text{ or } \lb I_{n_1n_2 - n_3 } \rb 
                        | pos integers #[m n_i,m].

                        | Need to compute regular models (implementation in Magma by Donnelly) and grobner bases of ideals of divisors to compute intersection multiplicities.
        remark
            p
                | Roughly speaking intersections are computing denominators which is why its not obvious how to go beyond integral points using this construction.

                | e.g. for elliptic curves have Mazur-Stein-Tate #[m p]-adic height.
                me h(P) = \frac 1p \log_p(\sigma (P)) - \frac 1p \log_p(D(P))
                | Coleman-Gross
                me h(P -\infty ) = h_p(P-\infty ) + \sum_{v\ne p} h_v(P-\infty )
                | extended appropriately.


        example: statement: p
            | Let
            me X\colon  y^2 = (x^3 + x + 1)(x^4 + 2x^3 - 3x^2 + 4x + 4)
            me C_{496}^J
            |  new modular curve studied by Baker Gonzalez-Jimenez Gonzalez, Poonen
            me J(\QQ) = \ZZ^3 \oplus \ZZ/2
            | let #[m P=(-1,2), Q= (0,2), R= (-2,12), S = (3,62)] want to show that up to hyperelliptic involution these are the only integral points.
            | Gens for #[m J(\QQ) \otimes \QQ].
            me \left\{P_{1}=[(P)-(\infty)], P_{2}=[(S)-(w(Q))], P_{3}=[(w(S))-(R)]\right\}




        aside: p Lecture 1? 31/10/2019

        p
            | Goal today: Give more context for quadratic chabauty, discuss Kim's nonabelian Chabauty program.
        p
            | References
            ol
                li
                    | #[q p-adic approaches to rational and integral points on curves] - Poonen
                li
                    | From chabauty's method to kim's non-abelian chabauty method - Corwin

        p
            | Let #[m X] be a  smooth projective curve over #[m K] a number field and let #[m Z] be a 0-dimensional subscheme.
            | Let #[m U = X-Z], #[m d= \#Z(\overline K)].
            | The topological Euler characteristic of #[m U] is #[m \chi (U) = \chi (X) - d = 2g-2 -d].
            | If #[m \chi (U) \lt 0] we say that #[m U ] is hyperbolic (we want to consider hyperbolic curves because they have nonabelian #[m \pi _1].)
        example: statement: p #[m g = 0], #[m d\ge 3] e.g. #[m \PP^1 \smallsetminus \{0,1,\infty \}].
        example: statement: p #[m g = 1], #[m d\ge 1] e.g. punctured elliptic curve #[m E \smallsetminus \{0\}].
        example: statement: p #[m g = 2], #[m d\ge 0] e.g. smooth projective curves of genus #[m g \ge 2] or punctured versions, integral points.

        p
            | Fix a prime #[m p] of good reduction for #[m X].


        p
            | Recall the classical Chabauty-Coleman diagram
            me.
                \xymatrix{
                X(K) \ar[r] \ar[d] &amp; X(K_p)\ar[d] &amp; \\
                J(K) \ar[r]  &amp; J(K_p)\ar[r] &amp; \Lie J_{K_p}
                }
            | in the classical chabauty-coleman method, the image of #[m J(K)] in the #[m g]-dimensional space #[m \Lie J_{K_p}] spans a #[m K_p] subspace of dimension at most #[m r = \rk J(K)].
            | So if #[m r \lt  g] there exists a non-zero #[m K_p] valued functional on #[m \Lie J_{K_p}] vanishing on #[m J(K)].
            | This pulls back to #[m d] non-zero locally analytic functions on #[m X(K_p)] that vanish on #[m X(K)].

        p
            | Problem: By using the geometry of #[m J] impose too much structure, can't extend this to #[m r \ge g].
            | Kim's idea:
            | Replace #[m J] with references to #[m X] and various homology groups, then generalize the diagram by replacing homology with various deeper quotients of (nonabelian) #[m \pi _1].
        p
            | Gives construction of Selmer varieties.

        p
            | References for Kims work:
            | Kim, Minhyong. “The Motivic Fundamental Group of #[m P^1 \smallsetminus  \{ 0,1,\infty \} ] and the Theorem of Siegel.” Inventiones Mathematicae 161, no. 3 (September 2005): 629–56. https://doi.org/10.1007/s00222-004-0433-9.
            | Kim, Minhyong. “The Unipotent Albanese Map and Selmer Varieties for Curves.” Publications of the Research Institute for Mathematical Sciences 45, no. 1 (2009): 89–133. https://doi.org/10.2977/prims/1234361156.
            | Kim, Minhyong. “Massey Products for Elliptic Curves of Rank 1.” Journal of the American Mathematical Society 23, no. 3 (2010): 725–47. https://doi.org/10.1090/S0894-0347-10-00665-X.



        p
            me.
                \xymatrix{
                X(K) \ar[r] \ar[d] &amp; X(K_p)\ar[d] &amp; \\
                J(K) \ar[r]\ar[d]  &amp; J(K_p)\ar[r]\ar[d] &amp; \Lie J_{K_p} \\
                \widehat{J(K)[1/p]} \ar[r] \ar[d] &amp; \widehat{J(K_p)[1/p]}\ar[ur] &amp; \\
                \Sel_{\QQ_p}(J) = H^1_f(G_{K}, V)\ar[r]\ar[d] &amp; H^1_f(G_{K_v}, V)\ar[r]\ar[d]  &amp; H_1^\dR(X_{K_p})/F^0 \\
                H^1(G_K, V) &amp;H^1(G_K, V)&amp;  &amp; 
                }
            | We want to start by removing #[m  J(K)] from the diagram.
            | Recall: Let #[m M] be an abelian group.
            | The #[m p]-adic completion
            me \widehat M = \varprojlim_n M/p^nM
            | is a #[m \ZZ_p]-module.
            | We can get  a #[m \QQ_p]-vector space by inverting #[m p].
            me \widehat M [1/p]\simeq \widehat M\otimes_{\ZZ_p} \QQ_p
            | .
            | The group #[m J(K_p)] is compact so that the images of #[m p^nJ(K_p)] in #[m \Lie J(K_p) \to 0], #[m p]-adically as #[m n\to \infty ]. So the homomorphism
            me J(K_p) \to \Lie J_{K_p}
            | factors through #[m \widehat {J(K_p)}] and hence also through  #[m \widehat{J(K_p)} \lb 1/p\rb ].
            | Since #[m \log ] is a local diffeomorphism with finite kernel get a #[m \QQ_p]-linear map
            me \widehat{J(K_p)} [1/p] \to \Lie J_{K_p}
            | is an isomorphism.

        p
            | Recall the Kummer exact sequence
            me 0 \to J[m] \to J \xrightarrow{\cdot m} J \to 0
            | take #[m G_K = \absgal K]-cohomology to get a long exact sequence which leads to a short exact sequence
            me 0 \to J(K)/mJ(K) \xrightarrow{\kappa_m } H^1(G_K, J[m]) \to H^1(G_K, J)[m] \to 0
            | where #[m \kappa ] is the Kummer map.
            | There is a canonical #[m G_K]-equivariant isomorphism 
            me J[m] \simeq H_1^\et(J_{\overline K}, \ZZ/m) \simeq H_1^\et(X_{\overline K}, \ZZ/m)
            | .
            | The Kummer map gives an embedding
            me J(K)/mJ(K) \hookrightarrow H^1(G_k, H^\et_1(X_{\overline K}, \ZZ/m))
            | to get an embedding of #[m J(K)] rather than just #[m J(K)/mJ(K)] take #[m m=p^n] and inverse limit.

        p
            | Get a #[m \ZZ_p]-Tate module.
            me T = \varprojlim_n J[p^n] \simeq H^\et_1(X_{\overline K}, \ZZ_p)
            | let #[m V = T\lb 1/p\rb  = T\otimes_{\ZZ_p} \QQ_p].
            | Let #[m J(K)_{\ZZ_p} = J(K) \otimes_\ZZ \ZZ_p], #[m J(K)_{\QQ_p} = J(K) \otimes_{\ZZ} \QQ_p].
        p
            | This gives us embeddings
            me J(K)_{\ZZ_p} \hookrightarrow H^1(G_K, T)
            me J(K)_{\QQ_p} \hookrightarrow H^1(G_K, V)
            | this is almost our replacement for #[m J].
        p
            | We still need to identify #[m \QQ_p]-span of #[m J(K)] inside #[m H^1(G_K, V)] using   #[m V] and without reference to #[m J].

        p
            | The vector space #[m V] has the structure of a #[m G_K]-rep so we want a Galois theoretic way of identifying the image of #[m J(K)_{\QQ_p}] in #[m H^1(G_K, V)].
            | This is where the Bloch-Kato Selmer groups come in.
            | Back to the fundamental short exact sequence from the Kummer sequence let #[m m=p^n] and we have the local diagram as well.

            me.
                \xymatrix{
                0 \ar[r]&amp; J(K)/mJ(K) \ar[d]\ar[r]^{\kappa } &amp;  H^1(G_K, J[m]) \ar[r]\ar[d]^\alpha &amp; H^1(G_K, J)[m] \ar[r]\ar[d]&amp; 0\\
                0 \ar[r]&amp;\prod_v J(K_v)/mJ(K_v) \ar[r]_\beta &amp;  \prod H^1(G_{K_v}, J[m]) \ar[r]&amp; \prod H^1(G_{K_v}, J)[m] \ar[r]&amp; 0
                }
            | the selmer group is a finite dimensional subspace of #[m H^1(G_K, J\lb p^n\rb )].
            me \Sel_{p^n}(J) = \alpha \inv(\im \beta )
            | we have
            me J(K)/p^nJ(K) \hookrightarrow \Sel_{p^n}(J)
            | now taking inverse limits gives
            me \widehat{J(K)} \hookrightarrow \Sel_{\ZZ_p} J \subseteq H^1 (G_K, T)
            | and inverting #[m p] gives
            me \widehat{J(K)}[1/p] \hookrightarrow \Sel_{\QQ_p} J \subseteq H^1 (G_K, V)
            | let #[m \Sha] be the Shafarevich-Tate group of #[m J]. we have
            me 0 \to J(K)/p^nJ(K) \to \Sel_{p^n}(J) \to \Sha[p^n] \to 0
            | take inverse limits and invert #[m p]
            me 0 \to \widehat{J(K)}[1/p]\to \Sel_{\QQ_p}(J) \to (\varprojlim_n \Sha[p^n])[1/p] \to 0
            | if #[m \Sha\lb p^\infty \rb] is finite, then
            me \varprojlim_n \Sha[p^n] = 0
            | so
            me \widehat{J(K)}[1/p]\simeq \Sel_{\QQ_p}(J)
            | we want to determine the image of #[m J(K)_{\QQ_p}] in #[m H^1(G_K, V)] in terms of #[m V] using #[m V] as a Galois rep.
            | We're almost there, we've replaced #[m J(K)_{\QQ_p} ] with #[m \Sel_{\QQ_p}(J)].

            | Remaining problem is that the local conditions giving us
            me \Sel_{\QQ_p}(J) \subseteq H^1(G_K, V)
            | we use information from the geometry of #[m J].
            | (certain subgroups of #[m \prod H^1(G_{K_v}, V)]).
            | This problem was solved by Bloch and Kato using Bloch-Kato Selmer groups.
            | use #[m p]-adic Hodge theory to re-interpret #[m \im \beta ].

        aside: p Lecture 1? 5/11/2019

        p
            | Recall the big chabauty-kim diagram.
        p
            | Last time we had this
            me.
                \xymatrix{
                J(K)/p^nJ(K) \ar[r] \ar[d] &amp; H^1(G_K, J[p^n])\ar[d]^\alpha \\
                \prod_v J(K_v)/p^nJ(K_v) \ar[r]_\beta  &amp; H^1(G_K, J[p^n])
                }
            me \Sel_{p^n}(J) = \alpha \inv(\im (\beta ))
            me \varprojlim_n \Sel_{p^n} (J) = \Sel_{\ZZ_p} J
            | , then we get
            me \widehat J(K) [1/p] \hookrightarrow \Sel_{\QQ_p} (J) \subseteq H^1(G_K, V)
            | .

        p
            | Goal is to determine the image of #[m J(K)_{\QQ_p}] in #[m H^1(G_K, V)] in terms of the Galois representation #[m V].
            | We replaced #[m J(K)_{\QQ_p}] by #[m \Sel_{\QQ_p}], defined by local conditions.
            | But the local conditions (subgroup of #[m \prod_v H^1(G_{K_v},V)] are defined via geometry of #[m J] rather than via galois reps.

        p
            | Bloch and Kato defined #[m \im \beta ] using #[m p]-adic Hodge theory and defined #[m \Sel_{\QQ_p} (J)] in terms of data from #[m V].
            ol
                li
                    | They wanted to extend Selmer and Shafarevich-Tate groups to motives beyond  #[m H^1] of abelian varieties.
                li
                    | this construction will let us extend the idea of Selmer group from
                    me T = H_1^\et(X_{\overline K}, \ZZ_p) \simeq \pi_1^\et(X_{\overline K})^\ab \otimes \ZZ_p
                    | to certain (non-abelian) quotients of #[m \pi_1^\et].
        p
            | Crash course in Bloch-Kato Selmer groups.
            | Let #[m V] be a finite dimensional #[m \QQ_q]-vector space with a continuous action of #[m G_{K_v}].

            | Let, #[m K_v = \QQ_p].
            | Fontaine defined #[m D_\cris (V)  = (B_{\cris} \otimes_{\QQ_p} V)^{G_{K_v}}] for a ring of p-adic periods #[m B_{cris}]
            | we have
            me  \dim_{K_v} D_{\cris} ( V) \le \dim_{\QQ_p} V
            | and if equality holds we say that #[m V] is crystalline.
            | See Berger, or Caruso, or Andre.
        p
            | An element #[m \xi  \in H^1(G_{K_v}, V)] corresponds to an isomorphism class of extensions of #[m \QQ_p] by #[m V]
            me 0\to V \to E \to \QQ_p \to 0
            | and #[m \xi ] is said to be crystalline if the galois representation is.
            | Let #[m H_f^1(G_{K_v}, V)] be the set of crystalline classes in #[m H^1(G_{K_v}, V)].
            | The #[q local Bloch-Kato Selmer group] at #[m v].

        definition
            statement: p
                | The Bloch-Kato Selmer group #[m H_f^1(G_{K_v}, V)] is the set of #[m \xi  \in H^1(G_K, V)] whose image in #[m H^1(G_{K_v}, V)] is crystalline for each #[m v| p].

        theorem
            title Bloch-Kato
            statement: p
                | The image of the Kummer map
                me \kappa _v \colon J(K_v)_\QQ \to H^1(G_{K_v}, V)
                | is #[m H_f^1(G_{K_v}, V)].

        corollary
            statement: p
                | The Selmer group
                me \Sel_{\QQ_p} J
                | coincides with #[m H^1_f(G_K, V)] in #[m H^1(G_K, V)].

        p
            | Need to also define log intrinsically, also needs a new target space in place of #[m \Lie J(K_{K_p})].
        definition
            statement: p
                | A filtered module over a commutative ring #][m R] is an #[m R]-module  #[m M] with a collection
                me \{ G^i M \}
                | of submodules that is decreasing
                me F^{i+1 } M \subseteq F^i M,\, \forall i
                | . If #[m \bigcup F^i M = M] the filtration is exhaustive.
                | For any filtered #[m R]-module #[m M] the associated graded module
                me \gr(M)  = \bigoplus _i \gr^i(M),\,\gr^i(M) = F^iM/F{i+1}M
                | .
        p
            | Recall the Hodge filtration on de Rham cohomology, this is a decreasing filtration #[m F^i] on #[m H^1_\dR(J_{K_p})] with 
            me 0 = F^2 \subseteq F^1 = H^0(J_{K_p}, \Omega ^1) \subseteq F^0 = H^1_\dR
            | .

        p
            | The de Rham cohomology #[m H^1_\dR(J_{K_p})]  is the dual of #[m H_1^\dR(J_{K_p})] and has a decreasing hodge filtration dual to that of #[m H^1_\dR(J_{K_p})], defined as
            me H^i H_1^\dR(J_{K_p}) = \Ann ( F^{-i + 1} H^1_\dR(J_{K_p}))].
        p
            me H^0(X, \Omega ^1)^\vee \simeq H^0(J, \Omega ^1) ^\vee = (\gr^1 H^1_\dR(J_{K_p}))^\vee = \gr^{-1} H_1^\dR( J_{K_p})
            me \gr^{-1} H_1^\dR(J_{K_p}) = H_1^\dR(J_{K_p}) / F^0H_1^\dR(J_{K_p}) \simeq H_1^\dR(X_{K_p}) / F^0H_1^\dR(X_{K_p})
            | this is our intrinsic definition of #[m H^0(X, \Omega ^1)^\vee].
        p
            | More of our crash course on #[m p]-adic hodge theory.
            | To define #[m \log_{BK}].

        p
            | We assume #[m K_p \simeq \QQ_p], Fontaine's theory defines a series of #[m \QQ_p]-algebras with #[m G_{\QQ_p}]-action and additional structure compatible with  this, (i.e. frob, differential operators, hodge)
            | we have
            me B_{crys} \subseteq B_{\dR}


            | ???

        p
            | Facts, theres a descending filtration #[m F^1] on #[m B_{\dR}], for which #[m B_{\dR}^+ = F^0 B_{dR}] is a DVR with fraction field #[m B_{\dR}] and residue field #[m \CC_p].

            | There is an  action of frobenius on #[m B_{crys}] whose fixed subring is denoted
            me B_{crys}^{\phi = 1}
            | .
            | We have #[m B_{crys}^{G_{K_p}} = B_{\dR}^{G_{K_p}}  = K_p].

        p
            | For a continuous #[m p]-adic representation #[m V] of #[m G_{\QQ_p}].
            | We define
            me D_\dR(V) = (B_{\dR} \otimes V)^{G_{K_p}}
            me D^+_\dR(V) = (B^+_{\dR} \otimes V)^{G_{K_p}}
            | the filtration on #[m B_{\dR}] induces one on #[m D_\dR(V)].
        p
            | If #[m Y] is a smooth variety over #[m \QQ_p] then #[m p]-adic height gives for
            me V = H^i_\et(Y_{\overline \QQ_p}, \QQ_p)
            | that
            me D_\dR(V) \xrightarrow\sim H^i_\dR(Y)
            | .
            | Respecting the Hodge filtration on either side.
            | Also #[m D_\dR^+(V)] is naturally identified with #[m F^0 D_\dR(V)].
            me F^m D_\dR(V) = (F^{m} B_\dR \otimes V)^{G_{K_v}}
            | Frobenius on #[m B_\crys] induces a Frobenius map on #[m D_\crys (V) ] and #[m V = H^i_\et(Y_{\overline \QQ_p}, \QQ_p)] and #[m Y] good reduction with special fibre #[m Y_{\FF_p}].
            | Then there's a natural isomorphism
            me D_\crys(V) \xrightarrow\sim H^1_\crys (Y_{\FF_p}, \QQ_p)
            | respects frob on each side.
        p
            | #[m D_\dR] and #[m D_\crys] commute with taking  #[m {}^\vee] so have correesponding results for homology.
        example
            statement: p
                | Let #[m V= H_1^\et(X_{\overline K}, \QQ_p)] then
                me H_1^\dR(X_{K_p})  \simeq D_\dR(V) \simeq D_\crys(V)]
                | compat with hodge 

        aside: p Lecture 1? 7/11/2019

        p
            me T = H_1^\et(X_{\overline K}, \ZZ_p)
            me V = H_1^\et(X_{\overline K}, \QQ_p)
            | want to define the Bloch-Kato logarithm.
            me \log_{BK} \colon H_{f}^1(G_{K_p}, V)\to H_1^\dR(X_{K_p}) /F^0
            | .
        p
            | Bloch-Kato 1990
            | give a short exact sequence
            me 0\to \QQ_p\xrightarrow\alpha B_{cris}^{\phi =1} \oplus B_{\dR}^+ \xrightarrow\beta  B_\dR \to 0
            | ,
            | where #[m \alpha (x) = (x,x),\beta (x,y) = x-y].
            | Tensor with #[m V] and take Galois cohomology to get
            me 0 \to V^{G_{K_p}} \to D_{cris}(V) ^{\phi =1} \oplus D_\dR^+(V) \to D_\dR(V)\to H^1(G_{K_p}, V)  \to H^1(G_{K_p},V\otimes B_{cris}^{\phi =1}) \to \cdots
            | Bloch-Kato show that
            me H^1_e(G_{K_p}, V) = \ker(H^1(G_{K_p}, V) \to  H^1(G_{K_p},V\otimes B_{cris}^{\phi =1}))
            | is equal to
            me H^1_f(G_{K_p}, V)
            | .
        p
            | This gives a surjection
            me D_\dR(V) / D_\dR^+(V) \to H_f^1(G_{K_p}, V)
            | this is the Bloch-Kato exponential map.
            | (coincides with usual #[m \exp] in the case of a #[m p]-adic formal lie group).
            | The kernel of this map is
            me D_{cris}(V)^{\phi =1}/V^{G_{K_p}}
            | this is trivial since #[m V] is the Tate module of an abelian variety (true because of the Weil conjecture, and what we know about eigenvalues of frobenius).
        p
            | So in this case the Bloch-Kato exponential map has an inverse, our Bloch-Kato logarithm.
            me \log_{BK} \colon H^1_f(G_{K_p}, V) \xrightarrow\sim D_\dR(V)/D_\dR^+ (V) \simeq H_1^\dR (X)/F^0
        p
            | Kim's generalization.
            | Let #[m G] be a group (resp. topological group).
            | For subgroups
            me A,B\subseteq G
            | let #[m \lb A,B\rb ] denote the (the closure of) the commutator of the subgroups.
        definition
            statement: p
                | Let
                me G^{\lb 1\rb } = G
                me G^{\lb 2\rb } =\lb  G^{\lb 1\rb } ,G\rb 
                me \ldots
                me G^{\lb i+1\rb } =\lb  G^{\lb i\rb } ,G\rb 
                | then
                me G^{\lb 1\rb } \unrhd G^{\lb 2\rb } \unrhd\cdots
                | is a descending chain of normal subgroups of #[m G] called the lower central series of #[m G].
                | Let #[m G_n = G/G^{\lb n + 1\rb }].

        example
            statement: p
                me G_1 = G/G^{\lb 1\rb } = G/\lb G,G\rb 
                | is the abelianization #[m G^{ab}] of #[m G].
                | For #[m n \ge 2] the group #[m G_n] is an #[m n]-step nilpotent group, typically nonabelian.
        p
            | Now for various flavours of #[m \pi _1(X)] we have
            me \pi _1(X)_1 = \pi _1(X) ^{ab} = H_1(X)
            | so above we should think of #[m H_1] as the abelianization of #[m \pi _1].
            | We can therefore try to replace it by #[m \pi _1(X)_n] for #[m n \gt  1].
            | We'll do this for the two homology groups associated to #[m X]
            ol
                li
                    | #[m p]-adic étale homology
                li
                    | de Rham homology
            | we can define the geometric étale fundamental group #[m \pi _1^\et (X_{\overline K})] such that
            me \pi_1^\et(X_{\overline K})^{ab} \simeq H_1^\et(X_{\overline K} , \widehat \ZZ)
            me \pi_1^\et(X_{\overline K})^{ab} \simeq H_1^\et(X_{\overline K} , \widehat \ZZ) \twoheadrightarrow H_1^\et(X_{\overline K}, \ZZ_p) \subseteq H_1^\et(X_{\overline K}, \QQ_p) = V = \GG_a^{2g}(\QQ_p)
            | with action of #[m G_K] in particular #[m G_K] acts via #[m \QQ_p]-linear automorphisms on #[m \GG_a^{2g}].

        p
            | For #[m n \ge 2] there's an analogous construction that transforms #[m \pi _1^\et(X_{\overline K})_n] into a topological group #[m V_n] that is the group of #[m \QQ_p]-points of a unipotent algebraic group #[m \mathcal V_n/\QQ_p], equipped with a #[m G_K]-action.
        definition
            statement: p
                | A pro-unipotent group over #[m \QQ_p] is a group scheme of #[m \QQ_p] that is a projective limit of unipotent  algebraic groups over #[m \QQ_p].

        p
            | Then there is a notion of #[m \QQ_p]-pro-unipotent completion
            me \pi_1^\et(X_{\overline K})_{\QQ_p}
            | of
            me \pi_1^\et(X_{\overline K})
            | there is a continuous homomorphism
            me \pi_1^\et(X_{\overline K}) \to \pi_1^\et(X_{\overline K})_{\QQ_p}(\QQ_p)
            | is universal among such maps.
        p
            | There are lower central series quotients
            me U_n^\et = \pi _1^\et(X_{\overline K})_{\QQ_{p,n}} = \pi _1^\et(X_{\overline K})_{\QQ_p}/ \pi _1^\et(X_{\overline K})_{\QQ_p} ^{\lb n + 1\rb }
            | .
        p
            | In the cases we consider, these are finite dimensional varieties.
            | The coordinate ring
            me \sheaf O(\pi _1^\et(X_{\overline K})_{\QQ_p})
            | is a #[m \QQ_p]-vector space.
            | Recall that for a smooth curve #[m X] we had
            me H_1^\dR(X_{K_p}) \simeq D_{\dR} (H_1^\et(X_{\overline K}, \QQ_p))
            | we may define the de Rham fundamental group
            me \pi _1^\dR(X_{K_p})
            | as
            me \Spec(D_{\dR}(\sheaf O(\pi _1^\et(X_{\overline K})_{\QQ_p})))
            | .
        p
            | #[m \pi _1^\dR] is equipped with a Hodge filtration.
            | Just like we took the lower central series filtration on #[m \pi _1^\et(X_{\overline K})_{\QQ_p}].
            | do the same thing for quotients by
            me \pi _1^\dR(X_{K_p})_n
            | We'll denote these as #[m U_n^\dR].
            | We have
            me U_n^\dR = D_{cris}(U_n^\et)
            | so it is equipped with a frobenius action.
        p
            | Now we have a non-abelian version of the Chabauty-Coleman diagram
            me.
                \xymatrix{
                X(K)\ar[r]\ar[d] &amp; X(K_p)\ar[d] \ar[dr] &amp; \\
                H^1_f(G_{K}, \pi _1^\et(X_{\overline K})_{\QQ_p, n}) &amp; H^1_f(G_{K_p}, U_n^\et) &amp; U_n^\dR / F^0
                }

        p
            | An element of
            me H_f^1(G_K, U_n^\et)
            | is a scheme over #[m \QQ_p] with continuous #[m G_K]-action and #[m G_K]-equivariant action of #[m U_n^\et] making it into a #[m U_n^\et]-torsor.
        p
            | Kim shows that
            me H_f^1(G_K, U_n^\et) \subseteq H^1 (G_K, U_n^\et)
            | has the structure of an algebraic variety the Selmer variety #[m \Sel(U_n)].

        p
            | We refer to #[m H^1_f(G_{K_p}, U_n^\et)] as the local Selmer variety.

        theorem
            title Kim
            statement: p
                | For some #[m n \gt 1] if
                me \dim \Sel(U_n) \lt \dim  H^1_f(G_{K_p}, U_n^\et)
                | then #[m X(K)] is contained in the zero locus of non-trivial locally analytic function on #[m X(K_p)] so #[m X(K)] is finite.


